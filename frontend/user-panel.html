<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Prompt Machine v1.5.0rc</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e'
                        },
                        purple: {
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9'
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        .project-card {
            transition: all 0.3s ease;
        }
        
        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .nav-item:hover {
            color: #2563eb;
        }
        
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .upgrade-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Navigation Bar -->
    <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-magic text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">Prompt Machine</h1>
                        <p class="text-xs text-gray-500">v1.5.0rc</p>
                    </div>
                </div>
                
                <div class="hidden md:flex items-center space-x-8">
                    <a href="/tools-directory.html" class="nav-item text-gray-700 hover:text-blue-600 font-medium">
                        <i class="fas fa-search mr-2"></i>Explore Tools
                    </a>
                    <a href="/prompt-engineer-v6.html" class="nav-item bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        <i class="fas fa-plus mr-2"></i>Create Tool
                    </a>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button id="notifications-btn" class="p-2 text-gray-400 hover:text-gray-600 relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span id="notification-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                        </button>
                    </div>
                    
                    <div class="relative">
                        <button id="profile-btn" class="flex items-center space-x-3 p-2 text-gray-700 hover:text-gray-900 rounded-lg">
                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-white text-sm"></i>
                            </div>
                            <div class="hidden md:block">
                                <span class="font-medium" id="user-name">User</span>
                                <p class="text-xs text-gray-500" id="user-plan">Free Plan</p>
                            </div>
                            <i class="fas fa-chevron-down text-sm"></i>
                        </button>
                        
                        <!-- Profile Dropdown -->
                        <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                            <div class="p-4 border-b border-gray-100">
                                <p class="text-sm font-medium text-gray-900" id="dropdown-email">user@example.com</p>
                                <p class="text-xs text-gray-500">Free Plan - 3 tools remaining</p>
                            </div>
                            <div class="py-2">
                                <a href="/analytics-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                    <i class="fas fa-chart-line mr-2"></i>View Analytics
                                </a>
                                <a href="/early-access.html" class="block px-4 py-2 text-sm text-purple-600 hover:bg-purple-50">
                                    <i class="fas fa-star mr-2"></i>Upgrade to Premium
                                </a>
                                <div class="border-t border-gray-100"></div>
                                <button onclick="logout()" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mobile menu button -->
                    <div class="md:hidden">
                        <button id="mobile-menu-button" class="text-gray-700 hover:text-blue-600">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Navigation -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
            <div class="px-4 py-3 space-y-2">
                <a href="/tools-directory.html" class="block px-3 py-2 text-gray-700 hover:text-blue-600 font-medium">
                    <i class="fas fa-search mr-2"></i>Explore Tools
                </a>
                <a href="/prompt-engineer-v6.html" class="block px-3 py-2 bg-blue-600 text-white rounded-lg font-medium">
                    <i class="fas fa-plus mr-2"></i>Create Tool
                </a>
            </div>
        </div>
    </nav>

    <!-- Upgrade Banner (for free users) -->
    <div id="upgrade-banner" class="upgrade-banner text-white py-4">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-star text-yellow-300 text-xl"></i>
                    <div>
                        <p class="font-semibold">Ready for unlimited AI tools?</p>
                        <p class="text-sm text-blue-100">Upgrade to premium and unlock advanced features</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <a href="/early-access.html" class="bg-white text-blue-600 px-6 py-2 rounded-lg font-medium hover:bg-blue-50 transition-colors">
                        Upgrade Now
                    </a>
                    <button onclick="hideUpgradeBanner()" class="text-blue-100 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Welcome Section -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">
                Welcome back, <span id="welcome-name">User</span>! ðŸ‘‹
            </h1>
            <p class="text-gray-600">Manage your AI tools and track their performance</p>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-magic text-blue-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Your Tools</p>
                        <p id="user-tools-count" class="text-2xl font-bold text-gray-900">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-rocket text-green-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Deployed</p>
                        <p id="deployed-tools-count" class="text-2xl font-bold text-gray-900">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-users text-purple-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Total Usage</p>
                        <p id="total-usage-count" class="text-2xl font-bold text-gray-900">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-chart-line text-orange-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">This Month</p>
                        <p id="monthly-usage-count" class="text-2xl font-bold text-gray-900">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Projects Section -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Your AI Tools</h2>
                    <p class="text-gray-600 mt-1">Create, manage, and deploy your AI-powered tools</p>
                </div>
                <a href="/prompt-engineer-v6.html" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors shadow-sm">
                    <i class="fas fa-plus mr-2"></i>Create New Tool
                </a>
            </div>

            <!-- Loading State -->
            <div id="projects-loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="loading-skeleton h-8 rounded mb-4"></div>
                    <div class="loading-skeleton h-4 rounded mb-2"></div>
                    <div class="loading-skeleton h-4 rounded w-3/4 mb-4"></div>
                    <div class="loading-skeleton h-10 rounded"></div>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="loading-skeleton h-8 rounded mb-4"></div>
                    <div class="loading-skeleton h-4 rounded mb-2"></div>
                    <div class="loading-skeleton h-4 rounded w-3/4 mb-4"></div>
                    <div class="loading-skeleton h-10 rounded"></div>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="loading-skeleton h-8 rounded mb-4"></div>
                    <div class="loading-skeleton h-4 rounded mb-2"></div>
                    <div class="loading-skeleton h-4 rounded w-3/4 mb-4"></div>
                    <div class="loading-skeleton h-10 rounded"></div>
                </div>
            </div>

            <!-- Projects Grid -->
            <div id="projects-grid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Projects will be loaded here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="hidden text-center py-12">
                <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-magic text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-4">No AI tools yet</h3>
                <p class="text-gray-600 mb-8 max-w-md mx-auto">
                    Start building your first AI tool! Our intuitive builder makes it easy to create powerful tools without coding.
                </p>
                <a href="/prompt-engineer-v6.html" class="inline-flex items-center bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    <i class="fas fa-plus mr-2"></i>Create Your First Tool
                </a>
            </div>

            <!-- Permission Error State -->
            <div id="permission-error" class="hidden bg-red-50 border border-red-200 rounded-lg p-6 text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-lock text-red-500 text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-red-900 mb-2">Access Restricted</h3>
                <p class="text-red-700 mb-4">You don't have permission to access this tool or it requires a premium subscription.</p>
                <a href="/early-access.html" class="inline-flex items-center bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                    <i class="fas fa-star mr-2"></i>Upgrade to Premium
                </a>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Activity</h3>
            <div id="recent-activity" class="space-y-4">
                <!-- Activity items will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let userProjects = [];

        // Check authentication
        function checkAuth() {
            const token = localStorage.getItem('authToken');
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            
            if (!token || !user.id) {
                window.location.href = '/login.html';
                return false;
            }
            
            // Update UI with user info
            const userName = user.email?.split('@')[0] || 'User';
            document.getElementById('user-name').textContent = userName;
            document.getElementById('welcome-name').textContent = userName;
            document.getElementById('dropdown-email').textContent = user.email || 'user@example.com';
            
            return true;
        }

        // Load user's projects
        async function loadUserProjects() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/v6/projects', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    userProjects = data.projects || [];
                    displayProjects();
                    updateStats();
                } else if (response.status === 403) {
                    showPermissionError();
                } else {
                    throw new Error('Failed to load projects');
                }
                
            } catch (error) {
                console.error('Error loading projects:', error);
                showError('Failed to load your tools. Please refresh the page.');
            }
        }

        // Display projects
        function displayProjects() {
            document.getElementById('projects-loading').classList.add('hidden');
            
            if (userProjects.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
                return;
            }
            
            const projectsGrid = document.getElementById('projects-grid');
            projectsGrid.classList.remove('hidden');
            
            const projectsHtml = userProjects.map(project => createProjectCard(project)).join('');
            projectsGrid.innerHTML = projectsHtml;
        }

        // Create project card
        function createProjectCard(project) {
            const isDeployed = project.deployed && project.subdomain;
            const statusColor = isDeployed ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
            const statusText = isDeployed ? 'Live' : 'Draft';
            
            return `
                <div class="project-card bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                                <i class="fas fa-magic text-white text-lg"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">${project.name}</h3>
                                <p class="text-sm text-gray-500">${project.ai_role || 'AI Assistant'}</p>
                            </div>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColor}">
                            ${statusText}
                        </span>
                    </div>
                    
                    <p class="text-gray-600 mb-4 line-clamp-2">${project.description || 'No description provided'}</p>
                    
                    <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                        <span><i class="fas fa-calendar mr-1"></i>${new Date(project.created_at).toLocaleDateString()}</span>
                        <span><i class="fas fa-eye mr-1"></i>${project.usage_count || 0} uses</span>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="editProject('${project.id}')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                            <i class="fas fa-edit mr-1"></i>Edit
                        </button>
                        ${isDeployed ? `
                            <button onclick="viewTool('${project.subdomain}')" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                                <i class="fas fa-external-link-alt mr-1"></i>View
                            </button>
                        ` : `
                            <button onclick="deployProject('${project.id}')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm">
                                <i class="fas fa-rocket mr-1"></i>Deploy
                            </button>
                        `}
                    </div>
                </div>
            `;
        }

        // Update stats
        function updateStats() {
            const deployedCount = userProjects.filter(p => p.deployed).length;
            const totalUsage = userProjects.reduce((sum, p) => sum + (p.usage_count || 0), 0);
            
            document.getElementById('user-tools-count').textContent = userProjects.length;
            document.getElementById('deployed-tools-count').textContent = deployedCount;
            document.getElementById('total-usage-count').textContent = totalUsage;
            document.getElementById('monthly-usage-count').textContent = Math.floor(totalUsage * 0.7); // Mock monthly data
        }

        // Project actions
        function editProject(projectId) {
            window.location.href = `/prompt-engineer-v6.html?project=${projectId}`;
        }

        function viewTool(subdomain) {
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (user.role !== 'admin' && subdomain) {
                // Check if user has permission (mock check)
                const hasPermission = Math.random() > 0.3; // 70% chance of access
                if (!hasPermission) {
                    showPermissionError();
                    return;
                }
            }
            
            if (subdomain) {
                window.open(`https://${subdomain}.tool.prompt-machine.com`, '_blank');
            }
        }

        function deployProject(projectId) {
            if (confirm('Deploy this tool to make it publicly accessible?')) {
                // Mock deployment
                alert('Deployment feature coming soon!');
            }
        }

        // Show permission error
        function showPermissionError() {
            document.getElementById('projects-loading').classList.add('hidden');
            document.getElementById('projects-grid').classList.add('hidden');
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('permission-error').classList.remove('hidden');
        }

        // Show error
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                document.body.removeChild(errorDiv);
            }, 5000);
        }

        // Hide upgrade banner
        function hideUpgradeBanner() {
            document.getElementById('upgrade-banner').classList.add('hidden');
        }

        // Profile dropdown
        document.getElementById('profile-btn').addEventListener('click', function() {
            document.getElementById('profile-dropdown').classList.toggle('hidden');
        });

        // Mobile menu
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const profileDropdown = document.getElementById('profile-dropdown');
            const profileBtn = document.getElementById('profile-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileBtn = document.getElementById('mobile-menu-button');
            
            if (!profileBtn.contains(event.target) && !profileDropdown.contains(event.target)) {
                profileDropdown.classList.add('hidden');
            }
            
            if (!mobileBtn.contains(event.target) && !mobileMenu.contains(event.target)) {
                mobileMenu.classList.add('hidden');
            }
        });

        // Logout function
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            window.location.href = '/login.html';
        }

        // Load recent activity (mock data)
        function loadRecentActivity() {
            const activities = [
                {
                    icon: 'fas fa-plus text-green-600',
                    text: 'Created new tool "Story Generator"',
                    time: '2 hours ago'
                },
                {
                    icon: 'fas fa-rocket text-blue-600',
                    text: 'Deployed "Recipe Finder" tool',
                    time: '1 day ago'
                },
                {
                    icon: 'fas fa-eye text-purple-600',
                    text: 'Your "Sales Assistant" was used 15 times',
                    time: '2 days ago'
                }
            ];
            
            const activityHtml = activities.map(activity => `
                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                    <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center shadow-sm">
                        <i class="${activity.icon} text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-900">${activity.text}</p>
                        <p class="text-xs text-gray-500">${activity.time}</p>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('recent-activity').innerHTML = activityHtml;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAuth()) {
                loadUserProjects();
                loadRecentActivity();
            }
        });
    </script>

</body>
</html>