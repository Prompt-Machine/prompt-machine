<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Prompt Machine v1.5.0rc</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e'
                        },
                        purple: {
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9'
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        .sidebar-item:hover {
            background-color: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }
        
        .sidebar-item.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Navigation Bar -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="px-6 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                    <i class="fas fa-magic text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-900">Prompt Machine Admin</h1>
                    <p class="text-xs text-gray-500">v1.5.0rc</p>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <button id="notifications-btn" class="p-2 text-gray-400 hover:text-gray-600 relative">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                    </button>
                </div>
                
                <div class="relative">
                    <button id="profile-btn" class="flex items-center space-x-3 p-2 text-gray-700 hover:text-gray-900">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-crown text-white text-sm"></i>
                        </div>
                        <span class="font-medium" id="admin-name">Admin</span>
                        <i class="fas fa-chevron-down text-sm"></i>
                    </button>
                    
                    <!-- Profile Dropdown -->
                    <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                        <div class="py-2">
                            <a href="#" onclick="showSection('prompt-engineer')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                <i class="fas fa-tools mr-2"></i>Build Tools
                            </a>
                            <a href="#" onclick="showSection('analytics')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                <i class="fas fa-chart-line mr-2"></i>Analytics
                            </a>
                            <div class="border-t border-gray-100"></div>
                            <button onclick="logout()" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex h-screen bg-gray-50">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-sm border-r border-gray-200">
            <nav class="mt-8">
                <div class="px-4">
                    <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Main</h3>
                </div>
                <div class="mt-4 space-y-1 px-2">
                    <a href="#" onclick="showSection('dashboard')" class="sidebar-item active flex items-center px-4 py-3 text-sm font-medium rounded-lg">
                        <i class="fas fa-chart-pie mr-3"></i>Dashboard
                    </a>
                    <a href="#" onclick="showSection('users')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-users mr-3"></i>Users
                    </a>
                    <a href="#" onclick="showSection('early-access')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-star mr-3"></i>Early Access
                    </a>
                    <a href="#" onclick="showSection('analytics')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-chart-line mr-3"></i>Analytics
                    </a>
                    <a href="#" onclick="showSection('packages')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-box mr-3"></i>Package Manager
                    </a>
                </div>
                
                <div class="mt-8 px-4">
                    <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Advertising & Monetization</h3>
                </div>
                <div class="mt-4 space-y-1 px-2">
                    <a href="#" onclick="showSection('google-adwords')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fab fa-google mr-3"></i>Google AdWords
                    </a>
                    <a href="#" onclick="showSection('affiliate-marketing')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-handshake mr-3"></i>Affiliate Marketing
                    </a>
                    <a href="#" onclick="showSection('other-advertising')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-bullhorn mr-3"></i>Other Advertising
                    </a>
                </div>
                
                <div class="mt-8 px-4">
                    <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">AI Tool Manager</h3>
                </div>
                <div class="mt-4 space-y-1 px-2">
                    <a href="#" onclick="showSection('prompt-engineer')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-magic mr-3"></i>Prompt Engineer
                    </a>
                    <!-- <a href="#" onclick="showSection('tools')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-cogs mr-3"></i>Tool Manager
                    </a> -->
                </div>
                
                <div class="mt-8 px-4">
                    <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">System</h3>
                </div>
                <div class="mt-4 space-y-1 px-2">
                    <a href="#" onclick="showSection('ai-config')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-robot mr-3"></i>AI Configuration
                    </a>
                    <a href="#" onclick="showSection('system-status')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-server mr-3"></i>System Status
                    </a>
                    <a href="#" onclick="showSection('settings')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-cog mr-3"></i>Settings
                    </a>
                    <a href="#" onclick="showSection('logs')" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg text-gray-700">
                        <i class="fas fa-file-alt mr-3"></i>System Logs
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto">
            
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="p-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Admin Dashboard</h2>
                    <p class="text-gray-600 mt-2">Monitor system performance and user activity</p>
                </div>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 card-hover transition-all duration-300">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-users text-blue-600 text-xl"></i>
                                </div>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Users</p>
                                <p id="total-users" class="text-2xl font-bold text-gray-900">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 card-hover transition-all duration-300">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-magic text-green-600 text-xl"></i>
                                </div>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Active Tools</p>
                                <p id="active-tools" class="text-2xl font-bold text-gray-900">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 card-hover transition-all duration-300">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-star text-purple-600 text-xl"></i>
                                </div>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Early Access</p>
                                <p id="early-access-signups" class="text-2xl font-bold text-gray-900">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 card-hover transition-all duration-300">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-chart-line text-orange-600 text-xl"></i>
                                </div>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Usage</p>
                                <p id="total-usage" class="text-2xl font-bold text-gray-900">-</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent User Signups</h3>
                        <div id="recent-users" class="space-y-3">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Users Section -->
            <div id="users-section" class="hidden p-8">
                <div class="mb-8 flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">Client Management</h2>
                        <p class="text-gray-600 mt-2">Manage client accounts, profiles, and billing information</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="exportClientData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="fas fa-download mr-2"></i>Export
                        </button>
                        <button onclick="showAddClientModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Client
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="relative">
                                    <input type="text" id="client-search" placeholder="Search clients..." onkeyup="searchClients()" class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                                </div>
                                <select id="status-filter" onchange="filterClients()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">All Statuses</option>
                                    <option value="active">Active</option>
                                    <option value="suspended">Suspended</option>
                                    <option value="closed">Closed</option>
                                    <option value="pending">Pending</option>
                                </select>
                                <select id="package-filter" onchange="filterClients()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">All Packages</option>
                                    <option value="none">No Package</option>
                                    <option value="public">Public</option>
                                    <option value="registered">Registered</option>
                                    <option value="premium">Premium</option>
                                    <option value="enterprise">Enterprise</option>
                                </select>
                            </div>
                            <div class="text-sm text-gray-500">
                                <span id="client-count">Loading...</span> clients
                            </div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Package</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Joined</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="clients-table-body" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="6" class="text-center py-8 text-gray-500">
                                        <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                                        <p>Loading clients...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Prompt Engineer Section -->
            <!-- Prompt Engineer Section -->
            <div id="prompt-engineer-section" class="hidden p-8">
                <div class="mb-8 flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">Prompt Engineer</h2>
                        <p class="text-gray-600 mt-2">Build and manage AI-powered tools with advanced prompt engineering</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="loadPromptEngineerProjects()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="fas fa-refresh mr-2"></i>Refresh
                        </button>
                        <button onclick="createNewProject()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="fas fa-plus mr-2"></i>Create New Tool
                        </button>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="projects-loading" class="flex justify-center items-center py-20">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                </div>

                <!-- Projects Grid -->
                <div id="projects-grid" class="hidden">
                    <!-- Quick Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-project-diagram text-blue-600 text-lg"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Projects</p>
                                    <p id="pe-total-projects" class="text-2xl font-bold text-gray-900">-</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-rocket text-green-600 text-lg"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Deployed</p>
                                    <p id="pe-deployed-projects" class="text-2xl font-bold text-gray-900">-</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-eye text-purple-600 text-lg"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Views</p>
                                    <p id="pe-total-views" class="text-2xl font-bold text-gray-900">-</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Projects List -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900">Your AI Tools</h3>
                                <div class="flex items-center space-x-3">
                                    <select id="status-filter" onchange="filterProjects()" class="text-sm border border-gray-300 rounded-lg px-3 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="all">All Projects</option>
                                        <option value="deployed">Deployed</option>
                                        <option value="draft">Draft</option>
                                        <option value="enabled">Enabled</option>
                                        <option value="disabled">Disabled</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div id="projects-list" class="divide-y divide-gray-200">
                            <!-- Projects will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="projects-empty" class="hidden text-center py-20">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-magic text-gray-400 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">No Projects Yet</h3>
                    <p class="text-gray-600 mb-6">Create your first AI tool to get started with prompt engineering.</p>
                    <button onclick="window.location.href='/prompt-engineer-v6.html'" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-plus mr-2"></i>Create Your First Tool
                    </button>
                </div>

                <!-- Embedded Prompt Engineer Interface -->
                <div id="prompt-engineer-container" class="hidden mt-8">
                    <!-- Prompt engineer interface will be loaded here -->
                </div>
            </div>

            <!-- Tools Section -->
            <div id="tools-section" class="hidden p-8">
                <div class="mb-8 flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">AI Tools Management</h2>
                        <p class="text-gray-600 mt-2">Monitor and manage deployed AI tools</p>
                    </div>
                    <div class="flex space-x-3">
                        <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="fas fa-download mr-2"></i>Export Data
                        </button>
                        <button onclick="window.location.href='/prompt-engineer-v6.html'" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="fas fa-plus mr-2"></i>Create Tool
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tool Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Owner</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usage</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tools-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Tools will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Early Access Section -->
            <div id="early-access-section" class="hidden p-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Early Access Management</h2>
                    <p class="text-gray-600 mt-2">Manage early access signups and invitations</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Signup Stats</h3>
                        <div id="early-access-stats" class="space-y-3">
                            <!-- Stats will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Signups</h3>
                        <div id="early-access-list" class="space-y-3">
                            <!-- Signups will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Other sections will be hidden by default -->
            <!-- Analytics Section - Integrated Dashboard -->
            <div id="analytics-section" class="hidden p-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Analytics Dashboard</h2>
                    <p class="text-gray-600 mt-2">Monitor your tool performance and usage statistics</p>
                </div>

                <!-- Analytics Loading State -->
                <div id="analytics-loading" class="flex justify-center items-center py-20">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                </div>

                <!-- Analytics Dashboard Content -->
                <div id="analytics-dashboard-content" class="hidden">
                    
                    <!-- Overview Stats -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 card-hover">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-project-diagram text-blue-600 text-lg"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Projects</p>
                                    <p id="total-projects" class="text-2xl font-bold text-gray-900">-</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 card-hover">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-eye text-green-600 text-lg"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Views</p>
                                    <p id="total-views" class="text-2xl font-bold text-gray-900">-</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 card-hover">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-users text-purple-600 text-lg"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Active Users</p>
                                    <p id="active-users" class="text-2xl font-bold text-gray-900">-</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 card-hover">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-chart-line text-yellow-600 text-lg"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Conversions</p>
                                    <p id="total-conversions" class="text-2xl font-bold text-gray-900">-</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <!-- Activity Trends Chart -->
                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900">Activity Trends</h3>
                                <div class="text-sm text-gray-500">Last 30 days</div>
                            </div>
                            <div class="h-64">
                                <canvas id="trends-chart"></canvas>
                            </div>
                        </div>

                        <!-- Device Breakdown -->
                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-900 mb-6">Device Breakdown</h3>
                            <div id="device-stats" class="space-y-4">
                                <!-- Device stats will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Top Projects Table -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-100">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900">Top Performing Projects</h3>
                                <button onclick="refreshAnalytics()" class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                                    <i class="fas fa-refresh mr-1"></i>Refresh
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Interactions</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sessions</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Completion Rate</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Completions</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="projects-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Projects will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
            
            <div id="settings-section" class="hidden p-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">System Settings</h2>
                    <p class="text-gray-600 mt-2">Configure system-wide settings and preferences</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold text-gray-900">System Configuration</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-700">API Rate Limiting</span>
                                    <span class="text-sm text-green-600">Active</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-700">Database Pool Size</span>
                                    <span class="text-sm text-gray-600">10 connections</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-700">Session Timeout</span>
                                    <span class="text-sm text-gray-600">24 hours</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold text-gray-900">Security Settings</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-700">HTTPS Enforcement</span>
                                    <span class="text-sm text-green-600">Enabled</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-700">CORS Protection</span>
                                    <span class="text-sm text-green-600">Active</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-700">Request Sanitization</span>
                                    <span class="text-sm text-green-600">Enabled</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="logs-section" class="hidden p-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">System Logs</h2>
                    <p class="text-gray-600 mt-2">Monitor system logs and error reports</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <div class="mb-4 flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-900">Recent System Activity</h3>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg">API Logs</button>
                            <button class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg">Error Logs</button>
                            <button class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg">Access Logs</button>
                        </div>
                    </div>
                    <div class="space-y-2 max-h-96 overflow-y-auto">
                        <div class="flex items-center justify-between p-3 bg-green-50 border-l-4 border-green-400 rounded">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-check-circle text-green-500"></i>
                                <span class="text-sm text-gray-700">API server started successfully</span>
                            </div>
                            <span class="text-xs text-gray-500">2 minutes ago</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-blue-50 border-l-4 border-blue-400 rounded">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-info-circle text-blue-500"></i>
                                <span class="text-sm text-gray-700">Database connection established</span>
                            </div>
                            <span class="text-xs text-gray-500">2 minutes ago</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 border-l-4 border-gray-400 rounded">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-user text-gray-500"></i>
                                <span class="text-sm text-gray-700">Admin user authenticated</span>
                            </div>
                            <span class="text-xs text-gray-500">5 minutes ago</span>
                        </div>
                        <div class="text-center py-4">
                            <p class="text-sm text-gray-500">Connect to server logs for real-time monitoring</p>
                            <button onclick="viewFullLogs()" class="mt-2 px-4 py-2 bg-gray-600 text-white rounded-lg text-sm">View Full Logs</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Configuration Section -->
            <div id="ai-config-section" class="hidden p-8">
                <div class="mb-8 flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">AI Configuration</h2>
                        <p class="text-gray-600 mt-2">Manage AI provider settings and API configurations</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="refreshAIConfig()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="fas fa-refresh mr-2"></i>Refresh
                        </button>
                    </div>
                </div>
                
                <!-- AI Configuration Interface Container -->
                <div id="ai-config-container" class="bg-white rounded-xl shadow-sm border border-gray-200 min-h-[600px]">
                    <!-- This will contain the integrated AI configuration interface -->
                    <div class="p-8 text-center">
                        <div class="max-w-md mx-auto">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-robot text-blue-600 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">AI Provider Configuration</h3>
                            <p class="text-gray-600 mb-6">Configure AI providers and manage API keys securely.</p>
                            <button onclick="openAIConfigInterface()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                                <i class="fas fa-settings mr-2"></i>Configure AI Providers
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status Section -->
            <div id="system-status-section" class="hidden p-8">
                <div class="mb-8 flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">System Status</h2>
                        <p class="text-gray-600 mt-2">Monitor system health and performance metrics</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="refreshSystemStatusInterface()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="fas fa-refresh mr-2"></i>Refresh
                        </button>
                    </div>
                </div>
                
                <!-- System Status Interface Container -->
                <div id="system-status-container" class="bg-white rounded-xl shadow-sm border border-gray-200 min-h-[600px]">
                    <!-- This will contain the system status interface -->
                    <div class="p-8 text-center">
                        <div class="max-w-md mx-auto">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-server text-green-600 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">System Health Monitor</h3>
                            <p class="text-gray-600 mb-6">Monitor API status, database health, and system performance.</p>
                            <button onclick="openSystemStatusInterface()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                                <i class="fas fa-chart-line mr-2"></i>View System Status
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Google AdWords Section -->
            <div id="google-adwords-section" class="hidden p-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Google AdWords Management</h2>
                    <p class="text-gray-600 mt-2">Manage Google Ads settings and campaigns for AI tools</p>
                </div>
                
                <div id="google-adwords-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-2xl mb-4 text-gray-400"></i>
                        <p class="text-gray-500">Loading advertising data...</p>
                    </div>
                </div>
            </div>

            <!-- Affiliate Marketing Section -->
            <div id="affiliate-marketing-section" class="hidden p-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Affiliate Marketing</h2>
                    <p class="text-gray-600 mt-2">Manage affiliate partnerships and commission-based monetization</p>
                </div>
                
                <!-- Affiliate Programs Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Amazon Associates -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                <i class="fab fa-amazon text-orange-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Amazon Associates</h3>
                                <p class="text-sm text-gray-500">Commission: 1-10%</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">World's largest affiliate program with millions of products</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Electronics, Books, Home & Garden</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>24-hour cookie duration</span>
                            </div>
                        </div>
                        <button onclick="configureAffiliate('amazon')" class="w-full bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg">
                            Configure Amazon Associates
                        </button>
                    </div>

                    <!-- Lenovo Affiliate -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-laptop text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Lenovo Affiliate</h3>
                                <p class="text-sm text-gray-500">Commission: 3-8%</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Premium laptops and business solutions</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>ThinkPad, IdeaPad, Legion series</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>30-day cookie duration</span>
                            </div>
                        </div>
                        <button onclick="configureAffiliate('lenovo')" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                            Configure Lenovo Affiliate
                        </button>
                    </div>

                    <!-- Best Buy Canada -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-store text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Best Buy Canada</h3>
                                <p class="text-sm text-gray-500">Commission: 1-4%</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Canada's top electronics retailer</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Electronics, Appliances, Gaming</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>7-day cookie duration</span>
                            </div>
                        </div>
                        <button onclick="configureAffiliate('bestbuy')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Configure Best Buy Affiliate
                        </button>
                    </div>

                    <!-- Canadian Tire -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-tools text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Canadian Tire</h3>
                                <p class="text-sm text-gray-500">Commission: 2-6%</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Tools, automotive, home & garden</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Automotive, Tools, Sports</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>30-day cookie duration</span>
                            </div>
                        </div>
                        <button onclick="configureAffiliate('canadiantire')" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                            Configure Canadian Tire
                        </button>
                    </div>

                    <!-- Microsoft Affiliate -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fab fa-microsoft text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Microsoft Affiliate</h3>
                                <p class="text-sm text-gray-500">Commission: 1-10%</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Software, Surface devices, Xbox</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Office 365, Azure, Surface</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>14-day cookie duration</span>
                            </div>
                        </div>
                        <button onclick="configureAffiliate('microsoft')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Configure Microsoft Affiliate
                        </button>
                    </div>

                    <!-- Shopify Affiliate -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-shopping-cart text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Shopify Affiliate</h3>
                                <p class="text-sm text-gray-500">Commission: $58-$2000</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">E-commerce platform and solutions</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>High commission rates</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>30-day cookie duration</span>
                            </div>
                        </div>
                        <button onclick="configureAffiliate('shopify')" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                            Configure Shopify Affiliate
                        </button>
                    </div>
                </div>
            </div>

            <!-- Other Advertising Platforms Section -->
            <div id="other-advertising-section" class="hidden p-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Other Advertising Platforms</h2>
                    <p class="text-gray-600 mt-2">Manage additional advertising networks and platforms</p>
                </div>
                
                <!-- Advertising Platforms Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Microsoft Advertising (Bing Ads) -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fab fa-microsoft text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Microsoft Advertising</h3>
                                <p class="text-sm text-gray-500">Bing Ads Network</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Search ads on Bing, Yahoo, and partner sites</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Lower competition than Google</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>LinkedIn audience targeting</span>
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('microsoft')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Configure Bing Ads
                        </button>
                    </div>

                    <!-- Meta Ads (Facebook & Instagram) -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fab fa-facebook text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Meta Ads</h3>
                                <p class="text-sm text-gray-500">Facebook & Instagram</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Social media advertising across Meta platforms</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Detailed audience targeting</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Visual ad formats</span>
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('meta')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Configure Meta Ads
                        </button>
                    </div>

                    <!-- LinkedIn Ads -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fab fa-linkedin text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">LinkedIn Ads</h3>
                                <p class="text-sm text-gray-500">Professional Network</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">B2B advertising and professional targeting</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Professional targeting</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>High-value B2B audience</span>
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('linkedin')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Configure LinkedIn Ads
                        </button>
                    </div>

                    <!-- Twitter Ads -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fab fa-twitter text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Twitter Ads</h3>
                                <p class="text-sm text-gray-500">Social Media Ads</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Real-time conversation and trending topics</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Trending topic targeting</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Real-time engagement</span>
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('twitter')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Configure Twitter Ads
                        </button>
                    </div>

                    <!-- Taboola -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-bullhorn text-purple-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Taboola</h3>
                                <p class="text-sm text-gray-500">Content Discovery</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Native advertising and content recommendations</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Native content ads</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Premium publisher network</span>
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('taboola')" class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                            Configure Taboola
                        </button>
                    </div>

                    <!-- Outbrain -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-brain text-orange-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-900">Outbrain</h3>
                                <p class="text-sm text-gray-500">Content Discovery</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">Native advertising and content promotion</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Premium publisher sites</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Interest-based targeting</span>
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('outbrain')" class="w-full bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg">
                            Configure Outbrain
                        </button>
                    </div>
                </div>
            </div>

            <!-- Package Manager Section -->
            <div id="packages-section" class="hidden p-8">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Package Manager</h2>
                    <p class="text-gray-600 mt-2">Manage user packages and subscription limits</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Packages -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">Available Packages</h3>
                        </div>
                        <div class="p-6">
                            <div id="packages-grid" class="space-y-4">
                                <div class="text-center py-8">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-4 text-gray-400"></i>
                                    <p class="text-gray-500">Loading packages...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Users -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">User Packages</h3>
                        </div>
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Package</th>
                                            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Usage</th>
                                            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="package-users-table-body" class="divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="4" class="text-center py-8 text-gray-500">
                                                <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                                                <p>Loading users...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        function checkAuth() {
            const token = localStorage.getItem('authToken');
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            
            if (!token || user.role !== 'admin') {
                window.location.href = '/login.html';
                return false;
            }
            
            document.getElementById('admin-name').textContent = user.email?.split('@')[0] || 'Admin';
            return true;
        }

        // Helper function to get time ago
        function getTimeAgo(date) {
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval > 1) return `${interval} years ago`;
            if (interval === 1) return '1 year ago';
            
            interval = Math.floor(seconds / 2592000);
            if (interval > 1) return `${interval} months ago`;
            if (interval === 1) return '1 month ago';
            
            interval = Math.floor(seconds / 86400);
            if (interval > 1) return `${interval} days ago`;
            if (interval === 1) return '1 day ago';
            
            interval = Math.floor(seconds / 3600);
            if (interval > 1) return `${interval} hours ago`;
            if (interval === 1) return '1 hour ago';
            
            interval = Math.floor(seconds / 60);
            if (interval > 1) return `${interval} minutes ago`;
            if (interval === 1) return '1 minute ago';
            
            return 'Just now';
        }

        // Show section
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId + '-section').classList.remove('hidden');
            
            // Add active class to clicked item
            event.target.classList.add('active');
            
            // Load section data
            loadSectionData(sectionId);
        }

        // Load section data
        async function loadSectionData(section) {
            switch (section) {
                case 'dashboard':
                    await loadDashboardData();
                    break;
                case 'users':
                    await loadUsersData();
                    break;
                case 'tools':
                    await loadToolsData();
                    break;
                case 'early-access':
                    await loadEarlyAccessData();
                    break;
                case 'ai-config':
                    await openAIConfigInterface();
                    break;
                case 'system-status':
                    await openSystemStatusInterface();
                    break;
                case 'prompt-engineer':
                    await openPromptEngineerInterface();
                    break;
                case 'google-adwords':
                    await loadGoogleAdWordsData();
                    break;
                case 'affiliate-marketing':
                    await loadAffiliateMarketingData();
                    break;
                case 'other-advertising':
                    await loadOtherAdvertisingData();
                    break;
                case 'analytics':
                    await loadAnalyticsData();
                    break;
                case 'packages':
                    await loadPackagesData();
                    break;
                case 'settings':
                    // Settings section is static, no data loading needed
                    break;
                case 'logs':
                    // Logs section is static, no data loading needed
                    break;
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load real stats from API with auth token
                const token = localStorage.getItem('authToken');
                const statsResponse = await fetch('/api/admin/dashboard/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    document.getElementById('total-users').textContent = statsData.stats.totalUsers.toLocaleString();
                    document.getElementById('active-tools').textContent = statsData.stats.activeTools.toLocaleString();
                    document.getElementById('early-access-signups').textContent = statsData.stats.earlyAccessSignups.toLocaleString();
                    document.getElementById('total-usage').textContent = statsData.stats.totalUsage.toLocaleString();
                } else {
                    throw new Error('Failed to load stats');
                }
                
                // Load recent users
                const usersResponse = await fetch('/api/admin/users/recent?limit=5', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const usersData = await usersResponse.json();
                
                if (usersData.success && usersData.users.length > 0) {
                    const recentUsersHtml = usersData.users.map(user => {
                        const initials = user.email.substring(0, 2).toUpperCase();
                        const timeAgo = getTimeAgo(new Date(user.created_at));
                        const bgColor = user.role === 'admin' ? 'bg-red-500' : 'bg-blue-500';
                        
                        return `
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <div class="w-8 h-8 ${bgColor} rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm font-medium">${initials}</span>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900">${user.email}</p>
                                    <p class="text-xs text-gray-500">Joined ${timeAgo}</p>
                                </div>
                                ${user.role === 'admin' ? '<span class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded">Admin</span>' : ''}
                            </div>
                        `;
                    }).join('');
                    document.getElementById('recent-users').innerHTML = recentUsersHtml;
                } else {
                    document.getElementById('recent-users').innerHTML = '<p class="text-gray-500 text-center py-4">No recent users</p>';
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Load users data
        async function loadUsersData() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/admin/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success && data.users.length > 0) {
                    const usersHtml = data.users.map(user => {
                        const initials = user.email.substring(0, 2).toUpperCase();
                        const bgColor = user.role === 'admin' ? 'bg-red-500' : 'bg-blue-500';
                        const roleColor = user.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800';
                        const timeAgo = getTimeAgo(new Date(user.created_at));
                        
                        return `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 ${bgColor} rounded-full flex items-center justify-center">
                                            <span class="text-white font-medium">${initials}</span>
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900">${user.email}</div>
                                            <div class="text-sm text-gray-500">ID: ${user.id.substring(0, 8)}...</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${roleColor}">
                                        ${user.role.charAt(0).toUpperCase() + user.role.slice(1)}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.tool_count || 0}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${timeAgo}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button onclick="editUser('${user.id}')" class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                                    ${user.role !== 'admin' ? `<button onclick="deleteUser('${user.id}')" class="text-red-600 hover:text-red-900">Delete</button>` : ''}
                                </td>
                            </tr>
                        `;
                    }).join('');
                    
                    document.getElementById('users-table-body').innerHTML = usersHtml;
                } else {
                    document.getElementById('users-table-body').innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">No users found</td></tr>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('users-table-body').innerHTML = '<tr><td colspan="5" class="text-center py-8 text-red-500">Error loading users</td></tr>';
            }
        }

        // Load tools data
        async function loadToolsData() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/v6/projects', {
                    headers: {
                        'Authorization': `Bearer ${token || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success && data.projects) {
                    const toolsHtml = data.projects.map(tool => {
                        const statusColor = tool.enabled ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                        const statusText = tool.enabled ? 'Active' : 'Inactive';
                        const deployedStatus = tool.deployed ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800';
                        
                        return `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">${tool.name}</div>
                                    <div class="text-sm text-gray-500">${tool.subdomain ? `${tool.subdomain}.tool.prompt-machine.com` : 'No subdomain'}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">${tool.owner_email || 'Unknown'}</div>
                                    <div class="text-xs text-gray-500">${tool.ai_role || 'AI Assistant'}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex flex-col space-y-1">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColor}">
                                            ${statusText}
                                        </span>
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${deployedStatus}">
                                            ${tool.deployed ? 'Deployed' : 'Draft'}
                                        </span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${tool.usage_count || 0}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    ${tool.deployed ? `<button onclick="viewTool('${tool.subdomain}')" class="text-blue-600 hover:text-blue-900 mr-3">View</button>` : ''}
                                    <button onclick="manageTool('${tool.id}')" class="text-green-600 hover:text-green-900 mr-3">Manage</button>
                                    <button onclick="toggleTool('${tool.id}', ${tool.enabled})" class="text-red-600 hover:text-red-900">
                                        ${tool.enabled ? 'Disable' : 'Enable'}
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                    
                    document.getElementById('tools-table-body').innerHTML = toolsHtml;
                } else {
                    document.getElementById('tools-table-body').innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">No tools found</td></tr>';
                }
            } catch (error) {
                console.error('Error loading tools:', error);
                document.getElementById('tools-table-body').innerHTML = '<tr><td colspan="5" class="text-center py-8 text-red-500">Error loading tools</td></tr>';
            }
        }

        // Tool Management Functions
        function viewTool(subdomain) {
            window.open(`https://${subdomain}.tool.prompt-machine.com`, '_blank');
        }
        
        async function manageTool(toolId) {
            // Switch to Prompt Engineer section and load this tool for editing
            showSection('prompt-engineer');
            await openPromptEngineerInterface();
            
            // After the interface loads, we need to communicate with the iframe to load the specific project
            setTimeout(() => {
                const iframe = document.querySelector('#prompt-engineer-container iframe');
                if (iframe && iframe.contentWindow) {
                    // Try to send a message to the iframe to load the specific project
                    iframe.contentWindow.postMessage({
                        type: 'LOAD_PROJECT',
                        projectId: toolId
                    }, '*');
                }
            }, 1000);
        }
        
        async function toggleTool(toolId, currentState) {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/v6/projects/${toolId}/toggle-enabled`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                if (data.success) {
                    // Reload the tools list
                    await loadToolsData();
                } else {
                    alert('Failed to toggle tool status: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error toggling tool:', error);
                alert('Failed to toggle tool status');
            }
        }

        // Load early access data
        async function loadEarlyAccessData() {
            try {
                const token = localStorage.getItem('authToken');
                const statsResponse = await fetch('/api/early-access/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    const statsHtml = `
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Signups</span>
                            <span class="font-semibold">${statsData.stats.total_signups || 0}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Last 24h</span>
                            <span class="font-semibold">${statsData.stats.signups_last_24h || 0}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Last Week</span>
                            <span class="font-semibold">${statsData.stats.signups_last_week || 0}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Activated Users</span>
                            <span class="font-semibold">${statsData.stats.activated_users || 0}</span>
                        </div>
                    `;
                    document.getElementById('early-access-stats').innerHTML = statsHtml;
                } else {
                    document.getElementById('early-access-stats').innerHTML = '<p class="text-red-500">Error loading stats</p>';
                }
                
                // Load recent signups
                const listResponse = await fetch('/api/early-access/list?limit=10');
                const listData = await listResponse.json();
                
                if (listData.success && listData.signups && listData.signups.length > 0) {
                    const listHtml = listData.signups.map(signup => {
                        const initials = signup.email.substring(0, 2).toUpperCase();
                        const statusColor = signup.status === 'activated' ? 'bg-green-500' : 
                                          signup.status === 'invited' ? 'bg-blue-500' : 'bg-purple-500';
                        const statusText = signup.status === 'activated' ? 'Active' :
                                         signup.status === 'invited' ? 'Invited' : 'Pending';
                        
                        return `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 ${statusColor} rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm font-medium">${initials}</span>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">${signup.email}</p>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-xs px-2 py-1 rounded-full ${statusColor} bg-opacity-20 text-gray-700">${statusText}</span>
                                        ${signup.use_case ? `<span class="text-xs text-gray-500">${signup.use_case}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-400">${getTimeAgo(new Date(signup.created_at))}</p>
                                ${signup.activated_at ? `<p class="text-xs text-green-600">Activated ${getTimeAgo(new Date(signup.activated_at))}</p>` : ''}
                            </div>
                        </div>
                    `;
                    }).join('');
                    
                    document.getElementById('early-access-list').innerHTML = listHtml;
                } else {
                    document.getElementById('early-access-list').innerHTML = '<p class="text-gray-500 text-center py-4">No early access signups yet</p>';
                }
                
            } catch (error) {
                console.error('Error loading early access data:', error);
                document.getElementById('early-access-stats').innerHTML = '<p class="text-red-500">Error loading stats</p>';
                document.getElementById('early-access-list').innerHTML = '<p class="text-red-500 text-center py-4">Error loading signups</p>';
            }
        }

        // Profile dropdown
        document.getElementById('profile-btn').addEventListener('click', function() {
            document.getElementById('profile-dropdown').classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('profile-dropdown');
            const button = document.getElementById('profile-btn');
            
            if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.add('hidden');
            }
        });

        // Logout function
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            window.location.href = '/login.html';
        }

        // Load detailed system status
        async function loadSystemStatus() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/admin/system/status/public', {
                    headers: {
                        'Authorization': `Bearer ${token || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success) {
                    displaySystemStatus(data.status);
                } else {
                    displaySystemError(data.error || 'Failed to load system status');
                }
            } catch (error) {
                console.error('Error loading system status:', error);
                displaySystemError('Network error loading system status');
            }
        }
        
        // Display system status
        function displaySystemStatus(status) {
            // API Status
            const apiStatusBadge = document.getElementById('api-status-badge');
            const apiDetails = document.getElementById('api-details');
            
            if (status.api.healthy) {
                apiStatusBadge.innerHTML = '<span class="w-2 h-2 bg-green-400 rounded-full mr-1"></span>Healthy';
                apiStatusBadge.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800';
                
                apiDetails.innerHTML = `
                    <div class="space-y-1">
                        <div>Status: <span class="font-medium text-green-600">Online</span></div>
                        <div>Uptime: <span class="font-medium">${status.api.uptime}</span></div>
                        <div>Version: <span class="font-medium">${status.api.version}</span></div>
                    </div>
                `;
            } else {
                apiStatusBadge.innerHTML = '<span class="w-2 h-2 bg-red-400 rounded-full mr-1"></span>Error';
                apiStatusBadge.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800';
                apiDetails.innerHTML = `
                    <div class="space-y-1">
                        <div>Status: <span class="font-medium text-red-600">Offline</span></div>
                        <div>Error: <span class="font-medium">${status.api.error || 'Unknown'}</span></div>
                    </div>
                `;
            }
            
            // Database Status
            const dbStatusBadge = document.getElementById('database-status-badge');
            const dbDetails = document.getElementById('database-details');
            
            if (status.database.connected) {
                dbStatusBadge.innerHTML = '<span class="w-2 h-2 bg-green-400 rounded-full mr-1"></span>Connected';
                dbStatusBadge.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800';
                
                dbDetails.innerHTML = `
                    <div class="space-y-1">
                        <div>Connection: <span class="font-medium text-green-600">Active</span></div>
                        <div>Pool Size: <span class="font-medium">${status.database.pool_size}</span></div>
                        <div>Active Connections: <span class="font-medium">${status.database.active_connections}</span></div>
                    </div>
                `;
            } else {
                dbStatusBadge.innerHTML = '<span class="w-2 h-2 bg-red-400 rounded-full mr-1"></span>Disconnected';
                dbStatusBadge.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800';
                dbDetails.innerHTML = `
                    <div class="space-y-1">
                        <div>Connection: <span class="font-medium text-red-600">Failed</span></div>
                        <div>Error: <span class="font-medium">${status.database.error || 'Unknown'}</span></div>
                    </div>
                `;
            }
            
            // AI Service Status
            const aiStatusBadge = document.getElementById('ai-status-badge');
            const aiDetails = document.getElementById('ai-details');
            
            if (status.ai_service.configured) {
                aiStatusBadge.innerHTML = '<span class="w-2 h-2 bg-green-400 rounded-full mr-1"></span>Active';
                aiStatusBadge.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800';
                
                aiDetails.innerHTML = `
                    <div class="space-y-1">
                        <div>Provider: <span class="font-medium">${status.ai_service.provider}</span></div>
                        <div>Model: <span class="font-medium">${status.ai_service.model}</span></div>
                        <div>Status: <span class="font-medium text-green-600">Ready</span></div>
                    </div>
                `;
            } else {
                aiStatusBadge.innerHTML = '<span class="w-2 h-2 bg-yellow-400 rounded-full mr-1"></span>Not Configured';
                aiStatusBadge.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800';
                
                aiDetails.innerHTML = `
                    <div class="space-y-1">
                        <div>Provider: <span class="font-medium">--</span></div>
                        <div>Model: <span class="font-medium">--</span></div>
                        <div>Status: <span class="font-medium text-yellow-600">Needs Configuration</span></div>
                    </div>
                `;
            }
            
            // Storage Status
            const storageStatusBadge = document.getElementById('storage-status-badge');
            const storageDetails = document.getElementById('storage-details');
            
            if (status.storage && status.storage.root_disk) {
                const usagePercent = status.storage.root_disk.usage_percentage;
                const isHighUsage = parseInt(usagePercent) > 80;
                
                let statusClass, statusText;
                if (isHighUsage > 90) {
                    statusClass = 'bg-red-100 text-red-800';
                    statusText = 'Critical';
                } else if (isHighUsage > 80) {
                    statusClass = 'bg-yellow-100 text-yellow-800';
                    statusText = 'Warning';
                } else {
                    statusClass = 'bg-green-100 text-green-800';
                    statusText = 'Good';
                }
                
                storageStatusBadge.innerHTML = `<span class="w-2 h-2 ${isHighUsage > 90 ? 'bg-red-400' : isHighUsage > 80 ? 'bg-yellow-400' : 'bg-green-400'} rounded-full mr-1"></span>${statusText}`;
                storageStatusBadge.className = `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClass}`;
                
                storageDetails.innerHTML = `
                    <div class="space-y-1">
                        <div>Disk Usage: <span class="font-medium">${usagePercent}%</span></div>
                        <div>Available: <span class="font-medium">${status.storage.root_disk.available_size}</span></div>
                        <div>Total Size: <span class="font-medium">${status.storage.root_disk.total_size}</span></div>
                    </div>
                `;
            } else {
                storageStatusBadge.innerHTML = '<span class="w-2 h-2 bg-red-400 rounded-full mr-1"></span>Unknown';
                storageStatusBadge.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800';
                storageDetails.innerHTML = `
                    <div class="space-y-1">
                        <div>Status: <span class="font-medium text-red-600">Error</span></div>
                        <div>Unable to get storage info</div>
                    </div>
                `;
            }
            
            // Update detailed system information section
            const detailedStatus = document.getElementById('detailed-status');
            if (detailedStatus) {
                detailedStatus.innerHTML = `
                    <div>
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Server Information</h4>
                        <div class="space-y-2 text-sm text-gray-600">
                            <div><span class="font-medium">Hostname:</span> ${status.system.hostname}</div>
                            <div><span class="font-medium">Platform:</span> ${status.system.platform}</div>
                            <div><span class="font-medium">Architecture:</span> ${status.system.arch}</div>
                            <div><span class="font-medium">Node Version:</span> ${status.system.node_version}</div>
                            <div><span class="font-medium">Memory Usage:</span> ${status.system.memory_usage}</div>
                            <div><span class="font-medium">CPU Usage:</span> ${status.system.cpu_usage}</div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Storage Details</h4>
                        <div class="space-y-2 text-sm text-gray-600">
                            <div><span class="font-medium">Total Size:</span> ${status.storage.root_disk.total_size}</div>
                            <div><span class="font-medium">Used:</span> ${status.storage.root_disk.used_size}</div>
                            <div><span class="font-medium">Available:</span> ${status.storage.root_disk.available_size}</div>
                            <div><span class="font-medium">Usage:</span> ${status.storage.root_disk.usage_percentage}%</div>
                        </div>
                    </div>
                `;
            }
        }
        
        // Display system error
        function displaySystemError(error) {
            ['api', 'database', 'ai', 'storage'].forEach(type => {
                const badge = document.getElementById(`${type}-status-badge`);
                const details = document.getElementById(`${type}-details`);
                badge.innerHTML = '<span class="w-2 h-2 bg-red-400 rounded-full mr-1"></span>Error';
                badge.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800';
                details.innerHTML = `<div class="text-red-600">${error}</div>`;
            });
        }
        
        // Refresh system status
        function refreshSystemStatus() {
            loadSystemStatus();
        }

        // Admin tool management functions
        function viewTool(subdomain) {
            if (subdomain) {
                window.open(`https://${subdomain}.tool.prompt-machine.com`, '_blank');
            }
        }
        
        function manageTool(toolId) {
            window.location.href = `/prompt-engineer-v6.html?project=${toolId}`;
        }
        
        function toggleTool(toolId, currentlyEnabled) {
            const action = currentlyEnabled ? 'disable' : 'enable';
            if (confirm(`Are you sure you want to ${action} this tool?`)) {
                // This would call an admin API to toggle tool status
                alert(`Tool ${action} functionality will be implemented soon.`);
            }
        }
        
        // User Management Functions
        function showAddUserModal() {
            document.getElementById('addUserModal').classList.remove('hidden');
            document.getElementById('userEmail').focus();
        }

        function hideAddUserModal() {
            document.getElementById('addUserModal').classList.add('hidden');
            document.getElementById('addUserForm').reset();
        }

        function showEditUserModal() {
            document.getElementById('editUserModal').classList.remove('hidden');
        }

        function hideEditUserModal() {
            document.getElementById('editUserModal').classList.add('hidden');
            document.getElementById('editUserForm').reset();
        }

        async function editUser(userId) {
            try {
                // Get user data first
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/admin/users`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success) {
                    const user = data.users.find(u => u.id === userId);
                    if (user) {
                        document.getElementById('editUserId').value = userId;
                        document.getElementById('editUserEmail').value = user.email;
                        
                        // Get package info if available
                        if (user.package_name) {
                            document.getElementById('editUserPackage').value = user.package_name;
                        }
                        
                        showEditUserModal();
                    }
                }
            } catch (error) {
                console.error('Error getting user data:', error);
                alert('Error loading user data');
            }
        }
        
        async function deleteClient(clientId) {
            if (!confirm('Are you sure you want to close this client account? This will set their status to closed.')) {
                return;
            }

            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/admin/clients/${clientId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('Client account closed successfully');
                    loadUsersData(); // Refresh the clients list
                } else {
                    alert(data.error || 'Failed to close client account');
                }
            } catch (error) {
                console.error('Error closing client account:', error);
                alert('Error closing client account');
            }
        }

        // Client management functions
        function showEditClientModal(client) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
                    <h3 class="text-xl font-semibold mb-6">Edit Client</h3>
                    <form id="editClientForm" class="space-y-4">
                        <input type="hidden" id="editClientId" value="${client.id}">
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                                <input type="text" id="editFirstName" value="${client.first_name || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                                <input type="text" id="editLastName" value="${client.last_name || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                            <input type="email" id="editEmail" value="${client.email || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                            <input type="tel" id="editPhone" value="${client.phone || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Address Line 1</label>
                            <input type="text" id="editAddress1" value="${client.address_line1 || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Address Line 2</label>
                            <input type="text" id="editAddress2" value="${client.address_line2 || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                                <input type="text" id="editCity" value="${client.city || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">State/Province</label>
                                <input type="text" id="editState" value="${client.state_province || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Postal Code</label>
                                <input type="text" id="editPostalCode" value="${client.postal_code || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                            <input type="text" id="editCountry" value="${client.country || 'United States'}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                            <input type="date" id="editDOB" value="${client.date_of_birth || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Account Status</label>
                            <select id="editAccountStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="active" ${client.account_status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="suspended" ${client.account_status === 'suspended' ? 'selected' : ''}>Suspended</option>
                                <option value="closed" ${client.account_status === 'closed' ? 'selected' : ''}>Closed</option>
                                <option value="pending" ${client.account_status === 'pending' ? 'selected' : ''}>Pending</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                            <textarea id="editNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">${client.notes || ''}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">New Password (leave blank to keep current)</label>
                            <input type="password" id="editPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Reason for Changes</label>
                            <input type="text" id="editChangeReason" placeholder="Brief reason for these changes" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="mt-8 flex justify-end space-x-3">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-300 hover:bg-gray-400 px-6 py-2 rounded-lg">Cancel</button>
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">Save Changes</button>
                        </div>
                    </form>
                </div>
            `;
            
            modal.addEventListener('submit', async function(e) {
                if (e.target.id === 'editClientForm') {
                    e.preventDefault();
                    await saveClientEdit();
                }
            });
            
            document.body.appendChild(modal);
        }

        async function saveClientEdit() {
            try {
                const clientId = document.getElementById('editClientId').value;
                const token = localStorage.getItem('authToken');
                
                const updateData = {
                    first_name: document.getElementById('editFirstName').value,
                    last_name: document.getElementById('editLastName').value,
                    email: document.getElementById('editEmail').value,
                    phone: document.getElementById('editPhone').value || null,
                    address_line1: document.getElementById('editAddress1').value || null,
                    address_line2: document.getElementById('editAddress2').value || null,
                    city: document.getElementById('editCity').value || null,
                    state_province: document.getElementById('editState').value || null,
                    postal_code: document.getElementById('editPostalCode').value || null,
                    country: document.getElementById('editCountry').value || 'United States',
                    date_of_birth: document.getElementById('editDOB').value || null,
                    account_status: document.getElementById('editAccountStatus').value,
                    notes: document.getElementById('editNotes').value || null,
                    change_reason: document.getElementById('editChangeReason').value || 'Admin update'
                };
                
                const password = document.getElementById('editPassword').value;
                if (password) {
                    updateData.password = password;
                }
                
                const response = await fetch(`/api/admin/clients/${clientId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Client updated successfully');
                    document.querySelector('.fixed').remove();
                    loadUsersData(); // Refresh the clients list
                } else {
                    alert(data.error || 'Failed to update client');
                }
            } catch (error) {
                console.error('Error updating client:', error);
                alert('Error updating client');
            }
        }

        async function viewClientHistory(clientId) {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/admin/clients/${clientId}/history`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success) {
                    showClientHistoryModal(data.history);
                } else {
                    alert('Failed to load client history: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error loading client history:', error);
                alert('Error loading client history');
            }
        }

        function showClientHistoryModal(history) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            const historyHtml = history.map(entry => {
                const timeAgo = getTimeAgo(new Date(entry.created_at));
                return `
                    <div class="border-l-4 border-blue-500 pl-4 py-3 border-b border-gray-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-medium text-gray-900">${entry.change_type.replace('_', ' ').toUpperCase()}</div>
                                <div class="text-sm text-gray-600">Field: ${entry.field_changed || 'N/A'}</div>
                                ${entry.old_value ? `<div class="text-sm text-gray-500">From: ${entry.old_value}</div>` : ''}
                                ${entry.new_value ? `<div class="text-sm text-gray-500">To: ${entry.new_value}</div>` : ''}
                                ${entry.change_reason ? `<div class="text-sm text-blue-600">Reason: ${entry.change_reason}</div>` : ''}
                            </div>
                            <div class="text-xs text-gray-400">${timeAgo}</div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            Changed by: ${entry.changed_by_name || entry.changed_by || 'System'}
                        </div>
                    </div>
                `;
            }).join('');
            
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-3xl w-full mx-4 max-h-screen overflow-y-auto">
                    <h3 class="text-xl font-semibold mb-6">Client Account History</h3>
                    <div class="space-y-1 max-h-96 overflow-y-auto">
                        ${history.length > 0 ? historyHtml : '<p class="text-gray-500 text-center py-8">No history found</p>'}
                    </div>
                    <div class="mt-8 flex justify-end">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-300 hover:bg-gray-400 px-6 py-2 rounded-lg">Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Add new client function
        function showAddClientModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
                    <h3 class="text-xl font-semibold mb-6">Add New Client</h3>
                    <form id="addClientForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                                <input type="text" id="addFirstName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                                <input type="text" id="addLastName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                            <input type="email" id="addEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password *</label>
                            <input type="password" id="addPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                            <input type="tel" id="addPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Address Line 1</label>
                            <input type="text" id="addAddress1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Address Line 2</label>
                            <input type="text" id="addAddress2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                                <input type="text" id="addCity" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">State/Province</label>
                                <input type="text" id="addState" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Postal Code</label>
                                <input type="text" id="addPostalCode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                            <input type="text" id="addCountry" value="United States" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                            <input type="date" id="addDOB" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Package</label>
                            <select id="addPackage" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">No Package</option>
                                <option value="free">Free Package</option>
                                <option value="basic">Basic Package</option>
                                <option value="premium">Premium Package</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                            <textarea id="addNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div class="mt-8 flex justify-end space-x-3">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-300 hover:bg-gray-400 px-6 py-2 rounded-lg">Cancel</button>
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">Create Client</button>
                        </div>
                    </form>
                </div>
            `;
            
            modal.addEventListener('submit', async function(e) {
                if (e.target.id === 'addClientForm') {
                    e.preventDefault();
                    await createNewClient();
                }
            });
            
            document.body.appendChild(modal);
        }

        async function createNewClient() {
            try {
                const token = localStorage.getItem('authToken');
                
                const clientData = {
                    first_name: document.getElementById('addFirstName').value,
                    last_name: document.getElementById('addLastName').value,
                    email: document.getElementById('addEmail').value,
                    password: document.getElementById('addPassword').value,
                    phone: document.getElementById('addPhone').value || null,
                    address_line1: document.getElementById('addAddress1').value || null,
                    address_line2: document.getElementById('addAddress2').value || null,
                    city: document.getElementById('addCity').value || null,
                    state_province: document.getElementById('addState').value || null,
                    postal_code: document.getElementById('addPostalCode').value || null,
                    country: document.getElementById('addCountry').value || 'United States',
                    date_of_birth: document.getElementById('addDOB').value || null,
                    package_name: document.getElementById('addPackage').value || null,
                    notes: document.getElementById('addNotes').value || null
                };
                
                const response = await fetch('/api/admin/clients', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(clientData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Client created successfully');
                    document.querySelector('.fixed').remove();
                    loadUsersData(); // Refresh the clients list
                } else {
                    alert(data.error || 'Failed to create client');
                }
            } catch (error) {
                console.error('Error creating client:', error);
                alert('Error creating client');
            }
        }

        // Search and filter functions
        function searchClients() {
            // Add debouncing to avoid too many API calls
            clearTimeout(window.searchTimeout);
            window.searchTimeout = setTimeout(() => {
                loadUsersData();
            }, 300);
        }

        function filterClients() {
            loadUsersData(); // This function now handles search and filter parameters
        }

        async function exportClientData() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/admin/clients?page=1&limit=1000', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success && data.clients.length > 0) {
                    // Convert to CSV
                    const headers = ['First Name', 'Last Name', 'Email', 'Phone', 'City', 'State/Province', 'Country', 'Package', 'Account Status', 'Created Date'];
                    const csvContent = [
                        headers.join(','),
                        ...data.clients.map(client => [
                            client.first_name || '',
                            client.last_name || '',
                            client.email || '',
                            client.phone || '',
                            client.city || '',
                            client.state_province || '',
                            client.country || '',
                            client.package_name || '',
                            client.account_status || '',
                            new Date(client.created_at).toLocaleDateString()
                        ].map(field => `"${field.toString().replace(/"/g, '""')}"`).join(','))
                    ].join('\\n');

                    // Create and download file
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `clients_export_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                    
                    alert('Client data exported successfully');
                } else {
                    alert('No client data to export');
                }
            } catch (error) {
                console.error('Error exporting client data:', error);
                alert('Error exporting client data');
            }
        }

        // Form submission handlers
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('addUserForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('userEmail').value;
                const packageName = document.getElementById('userPackage').value;
                
                try {
                    const token = localStorage.getItem('authToken');
                    const response = await fetch('/api/admin/users', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            email: email,
                            package: packageName || undefined
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        alert('User created successfully');
                        hideAddUserModal();
                        loadUsersData(); // Refresh the users list
                    } else {
                        alert(data.error || 'Failed to create user');
                    }
                } catch (error) {
                    console.error('Error creating user:', error);
                    alert('Error creating user');
                }
            });

            document.getElementById('editUserForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const userId = document.getElementById('editUserId').value;
                const email = document.getElementById('editUserEmail').value;
                const packageName = document.getElementById('editUserPackage').value;
                
                try {
                    const token = localStorage.getItem('authToken');
                    
                    // Update user email
                    const userResponse = await fetch(`/api/admin/users/${userId}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email })
                    });

                    // Update package if specified
                    if (packageName) {
                        const packageResponse = await fetch(`/api/admin/users/${userId}/package`, {
                            method: 'PUT',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ package: packageName })
                        });
                    }

                    const data = await userResponse.json();
                    
                    if (data.success) {
                        alert('User updated successfully');
                        hideEditUserModal();
                        loadUsersData(); // Refresh the users list
                    } else {
                        alert(data.error || 'Failed to update user');
                    }
                } catch (error) {
                    console.error('Error updating user:', error);
                    alert('Error updating user');
                }
            });
        });

        // User filtering function
        function filterUsers() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            const roleFilter = document.getElementById('role-filter').value;
            const tableRows = document.querySelectorAll('#users-table-body tr');

            tableRows.forEach(row => {
                const emailCell = row.querySelector('td:first-child .text-sm.font-medium');
                const roleCell = row.querySelector('td:nth-child(2) span');
                
                if (emailCell && roleCell) {
                    const email = emailCell.textContent.toLowerCase();
                    const role = roleCell.textContent.toLowerCase();
                    
                    const matchesSearch = email.includes(searchTerm);
                    const matchesRole = !roleFilter || role.includes(roleFilter);
                    
                    if (matchesSearch && matchesRole) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        // System functions
        function viewFullLogs() {
            alert('Full logs viewer would connect to server logs API - feature can be enhanced to show live log streaming');
        }

        // Legacy Prompt Engineer Functions - removed to avoid conflicts

        // AI Configuration Functions
        async function openAIConfigInterface() {
            const container = document.getElementById('ai-config-container');
            
            // Show loading state
            container.innerHTML = `
                <div class="p-8 text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">Loading AI Configuration...</p>
                </div>
            `;
            
            // Use iframe for reliable loading and JavaScript execution
            container.innerHTML = `
                <iframe 
                    src="/ai-config.html" 
                    class="w-full h-[900px] border-0 rounded-xl"
                    frameborder="0"
                    allow="clipboard-read; clipboard-write"
                    style="background: white; border-radius: 12px;"
                    onload="console.log('AI Configuration loaded successfully')"
                ></iframe>
            `;
        }
        
        function refreshAIConfig() {
            // Refresh the AI configuration interface
            const container = document.getElementById('ai-config-container');
            container.innerHTML = `
                <div class="p-8 text-center">
                    <div class="max-w-md mx-auto">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-check text-green-600 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Configuration Refreshed</h3>
                        <p class="text-gray-600 mb-6">AI provider configurations have been reloaded.</p>
                        <button onclick="openAIConfigInterface()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                            <i class="fas fa-settings mr-2"></i>Configure AI Providers
                        </button>
                    </div>
                </div>
            `;
        }

        // System Status Functions
        async function openSystemStatusInterface() {
            const container = document.getElementById('system-status-container');
            
            // Show loading state
            container.innerHTML = `
                <div class="p-8 text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">Loading System Status...</p>
                </div>
            `;
            
            // Load system status directly using existing functions
            container.innerHTML = `
                <div class="p-6">
                    <!-- System Status Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- API Status -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-gray-900">API Status</h3>
                                <div id="api-status-badge" class="px-2 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded-full">
                                    Loading...
                                </div>
                            </div>
                            <div id="api-details" class="text-sm text-gray-600">
                                <div class="space-y-1">
                                    <div>Status: <span class="font-medium">Checking...</span></div>
                                    <div>Uptime: <span class="font-medium">--</span></div>
                                    <div>Version: <span class="font-medium">--</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- Database Status -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-gray-900">Database</h3>
                                <div id="database-status-badge" class="px-2 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded-full">
                                    Loading...
                                </div>
                            </div>
                            <div id="database-details" class="text-sm text-gray-600">
                                <div class="space-y-1">
                                    <div>Connection: <span class="font-medium">Checking...</span></div>
                                    <div>Pool Size: <span class="font-medium">--</span></div>
                                    <div>Active Connections: <span class="font-medium">--</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Service Status -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-gray-900">AI Service</h3>
                                <div id="ai-status-badge" class="px-2 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded-full">
                                    Loading...
                                </div>
                            </div>
                            <div id="ai-details" class="text-sm text-gray-600">
                                <div class="space-y-1">
                                    <div>Provider: <span class="font-medium">--</span></div>
                                    <div>Model: <span class="font-medium">--</span></div>
                                    <div>Status: <span class="font-medium">Checking...</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- Storage Status -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-gray-900">Storage</h3>
                                <div id="storage-status-badge" class="px-2 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded-full">
                                    Loading...
                                </div>
                            </div>
                            <div id="storage-details" class="text-sm text-gray-600">
                                <div class="space-y-1">
                                    <div>Disk Usage: <span class="font-medium">--</span></div>
                                    <div>Available: <span class="font-medium">--</span></div>
                                    <div>Database Size: <span class="font-medium">--</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed System Information -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-medium text-gray-900">Detailed System Information</h3>
                                <button onclick="loadSystemStatus()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    <i class="fas fa-refresh mr-2"></i>Refresh
                                </button>
                            </div>
                        </div>
                        <div class="p-6">
                            <div id="detailed-status" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Detailed information will be loaded here -->
                                <div class="text-center text-gray-500 py-8 col-span-2">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-4"></i>
                                    <p>Loading detailed system information...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load the actual system status data using existing function
            await loadSystemStatus();
        }
        
        function refreshSystemStatusInterface() {
            // Refresh the system status interface
            const container = document.getElementById('system-status-container');
            container.innerHTML = `
                <div class="p-8 text-center">
                    <div class="max-w-md mx-auto">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-check text-green-600 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Status Refreshed</h3>
                        <p class="text-gray-600 mb-6">System status information has been updated.</p>
                        <button onclick="openSystemStatusInterface()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                            <i class="fas fa-chart-line mr-2"></i>View System Status
                        </button>
                    </div>
                </div>
            `;
        }

        // Advertising Manager Functions
        async function loadAdvertisingData() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/admin/advertising/all', {
                    headers: {
                        'Authorization': `Bearer ${token || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success) {
                    displayAdvertisingData(data.tools || []);
                } else {
                    document.getElementById('google-adwords-content').innerHTML = '<p class="text-red-500 text-center py-8">Error loading advertising data</p>';
                }
            } catch (error) {
                console.error('Error loading advertising:', error);
                document.getElementById('google-adwords-content').innerHTML = '<p class="text-red-500 text-center py-8">Failed to load advertising data</p>';
            }
        }
        
        function displayAdvertisingData(tools) {
            const content = tools.length > 0 ? tools.map(tool => `
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">${tool.name}</h4>
                    <p class="text-gray-600 mb-4">${tool.description || 'No description available'}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-500">Status: ${tool.ad_enabled ? 'Active' : 'Inactive'}</span>
                        <button onclick="manageAdvertising('${tool.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                            Manage Ads
                        </button>
                    </div>
                </div>
            `).join('') : '<p class="text-gray-500 text-center py-8">No tools available for advertising</p>';
            
            document.getElementById('google-adwords-content').innerHTML = content;
        }
        
        // Advertising Management Functions
        async function manageAdvertising(toolId) {
            try {
                // Get current advertising data for this tool
                const response = await fetch('/api/admin/advertising/all', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken') || 'dummy-token'}`
                    }
                });
                const data = await response.json();
                const tool = data.tools.find(t => t.id === toolId);
                
                if (!tool) {
                    alert('Tool not found');
                    return;
                }
                
                // Create advertising management modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold">Manage Ads - ${tool.name}</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form id="ad-management-form" class="space-y-6">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" id="ad-enabled" ${tool.ad_enabled ? 'checked' : ''} 
                                       class="rounded text-blue-600" onchange="toggleAdConfiguration()">
                                <label for="ad-enabled" class="text-lg font-medium text-gray-900">Enable Advertisements</label>
                            </div>
                            
                            <div id="ad-config-section" class="${tool.ad_enabled ? '' : 'hidden'} space-y-4 p-4 bg-gray-50 rounded-lg">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Ads Client ID</label>
                                        <input type="text" id="google-client-id" 
                                               value="${tool.google_ads_client_id || ''}" 
                                               placeholder="ca-pub-xxxxxxxxxx" 
                                               class="w-full p-3 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Ads Slot ID</label>
                                        <input type="text" id="google-slot-id" 
                                               value="${tool.google_ads_slot_id || ''}" 
                                               placeholder="xxxxxxxxxx" 
                                               class="w-full p-3 border border-gray-300 rounded-lg">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ad Placement</label>
                                    <div class="grid grid-cols-3 gap-4">
                                        <div class="flex items-center space-x-2">
                                            <input type="checkbox" id="header-ads" ${tool.show_header_ad ? 'checked' : ''} class="rounded text-blue-600">
                                            <label for="header-ads" class="text-sm text-gray-700">Header</label>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <input type="checkbox" id="footer-ads" ${tool.show_footer_ad ? 'checked' : ''} class="rounded text-blue-600">
                                            <label for="footer-ads" class="text-sm text-gray-700">Footer</label>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <input type="checkbox" id="sidebar-ads" ${tool.show_sidebar_ad ? 'checked' : ''} class="rounded text-blue-600">
                                            <label for="sidebar-ads" class="text-sm text-gray-700">Sidebar</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="flex items-center space-x-3">
                                        <input type="checkbox" id="revenue-share" ${tool.revenue_share_enabled ? 'checked' : ''} class="rounded text-blue-600">
                                        <label for="revenue-share" class="text-sm font-medium text-gray-700">Enable Revenue Sharing</label>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Platform Revenue %</label>
                                        <input type="number" id="platform-percentage" 
                                               value="${tool.platform_revenue_percentage || 10}" 
                                               min="0" max="100" step="0.1"
                                               class="w-full p-3 border border-gray-300 rounded-lg">
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-blue-900 mb-2">Current Statistics</h4>
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <span class="text-blue-700">Clicks Tracked:</span>
                                            <span class="font-medium">${tool.clicks_tracked || 0}</span>
                                        </div>
                                        <div>
                                            <span class="text-blue-700">Impressions:</span>
                                            <span class="font-medium">${tool.impressions_tracked || 0}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3 pt-4">
                                <button type="button" onclick="this.closest('.fixed').remove()" 
                                        class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                                    Cancel
                                </button>
                                <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Add form submit handler
                document.getElementById('ad-management-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    saveAdvertisingSettings(toolId, modal);
                });
                
            } catch (error) {
                console.error('Error loading advertising data:', error);
                alert('Failed to load advertising data');
            }
        }
        
        function toggleAdConfiguration() {
            const adEnabled = document.getElementById('ad-enabled').checked;
            const configSection = document.getElementById('ad-config-section');
            
            if (adEnabled) {
                configSection.classList.remove('hidden');
            } else {
                configSection.classList.add('hidden');
            }
        }
        
        async function saveAdvertisingSettings(toolId, modal) {
            try {
                const adSettings = {
                    enabled: document.getElementById('ad-enabled').checked,
                    google_ads_client_id: document.getElementById('google-client-id').value,
                    google_ads_slot_id: document.getElementById('google-slot-id').value,
                    show_header_ad: document.getElementById('header-ads').checked,
                    show_footer_ad: document.getElementById('footer-ads').checked,
                    show_sidebar_ad: document.getElementById('sidebar-ads').checked,
                    revenue_share_enabled: document.getElementById('revenue-share').checked,
                    platform_revenue_percentage: parseFloat(document.getElementById('platform-percentage').value || 10.0)
                };
                
                const response = await fetch('/api/admin/advertising/configure', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken') || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        toolId: toolId,
                        adSettings: adSettings
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('Advertising settings saved successfully!');
                    modal.remove();
                    // Reload advertising data
                    await loadAdvertisingData();
                } else {
                    alert('Failed to save advertising settings: ' + (data.error || 'Unknown error'));
                }
                
            } catch (error) {
                console.error('Error saving advertising settings:', error);
                alert('Failed to save advertising settings');
            }
        }

        // New Advertising & Monetization Functions
        async function loadGoogleAdWordsData() {
            // Reuse existing advertising functionality for Google AdWords section
            await loadAdvertisingData();
        }

        async function loadAffiliateMarketingData() {
            const container = document.getElementById('affiliate-marketing-content');
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Amazon Associates -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i class="fab fa-amazon text-orange-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Amazon Associates</h4>
                                    <p class="text-sm text-gray-500">4-10% commission</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Active in Canada</span>
                        </div>
                        <p class="text-gray-600 mb-4">Promote millions of products from Amazon.ca with competitive commission rates.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Wide product selection
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Trusted brand recognition
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Real-time reporting
                            </div>
                        </div>
                        <button onclick="configureAffiliate('amazon')" class="w-full bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Amazon
                        </button>
                    </div>

                    <!-- Best Buy Canada -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-tv text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Best Buy Canada</h4>
                                    <p class="text-sm text-gray-500">1-4% commission</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Canada Focused</span>
                        </div>
                        <p class="text-gray-600 mb-4">Electronics, appliances, and tech products with Canadian-specific promotions.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Electronics specialty
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Canadian market focus
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Seasonal promotions
                            </div>
                        </div>
                        <button onclick="configureAffiliate('bestbuy')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Best Buy
                        </button>
                    </div>

                    <!-- Canadian Tire -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-tools text-red-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Canadian Tire</h4>
                                    <p class="text-sm text-gray-500">2-8% commission</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Canadian Icon</span>
                        </div>
                        <p class="text-gray-600 mb-4">Home improvement, automotive, sports, and outdoor products from Canada's retail icon.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Home & automotive focus
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Strong Canadian presence
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Triangle Rewards integration
                            </div>
                        </div>
                        <button onclick="configureAffiliate('canadiantire')" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Canadian Tire
                        </button>
                    </div>

                    <!-- Microsoft -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fab fa-microsoft text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Microsoft</h4>
                                    <p class="text-sm text-gray-500">1-10% commission</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Global</span>
                        </div>
                        <p class="text-gray-600 mb-4">Software, hardware, and cloud services with high-value tech products.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                High-value products
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Enterprise & consumer
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Subscription services
                            </div>
                        </div>
                        <button onclick="configureAffiliate('microsoft')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Microsoft
                        </button>
                    </div>

                    <!-- Shopify -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fab fa-shopify text-green-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Shopify</h4>
                                    <p class="text-sm text-gray-500">200% commission</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Canadian</span>
                        </div>
                        <p class="text-gray-600 mb-4">E-commerce platform with generous recurring commission structure.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Recurring revenue
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                High lifetime value
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Canadian company
                            </div>
                        </div>
                        <button onclick="configureAffiliate('shopify')" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Shopify
                        </button>
                    </div>

                    <!-- Lenovo -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-laptop text-gray-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Lenovo</h4>
                                    <p class="text-sm text-gray-500">3-8% commission</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Tech Focused</span>
                        </div>
                        <p class="text-gray-600 mb-4">Computers, laptops, and enterprise technology solutions with competitive rates.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Premium computers
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Enterprise solutions
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                High-ticket items
                            </div>
                        </div>
                        <button onclick="configureAffiliate('lenovo')" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Lenovo
                        </button>
                    </div>
                </div>
                
                <div class="mt-8 bg-blue-50 p-6 rounded-xl">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-info-circle text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-blue-900 mb-2">Getting Started with Affiliate Marketing</h4>
                            <p class="text-blue-800 mb-4">Configure your affiliate accounts to start earning commissions from your AI tools. Each program has different requirements and commission structures.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700">
                                <div class="space-y-2">
                                    <div class="flex items-center">
                                        <i class="fas fa-check text-blue-600 mr-2"></i>
                                        Apply to affiliate programs
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-check text-blue-600 mr-2"></i>
                                        Get approved and receive tracking IDs
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex items-center">
                                        <i class="fas fa-check text-blue-600 mr-2"></i>
                                        Configure tracking parameters
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-check text-blue-600 mr-2"></i>
                                        Monitor performance and earnings
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadOtherAdvertisingData() {
            const container = document.getElementById('other-advertising-content');
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Microsoft Advertising (Bing) -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-search text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Microsoft Advertising</h4>
                                    <p class="text-sm text-gray-500">Bing & Partner Sites</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Search Ads</span>
                        </div>
                        <p class="text-gray-600 mb-4">Reach users on Bing, Yahoo, and Microsoft partner sites with competitive costs.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Lower competition than Google
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Microsoft ecosystem reach
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Professional demographics
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('microsoft-ads')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Microsoft Ads
                        </button>
                    </div>

                    <!-- Meta Ads (Facebook/Instagram) -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fab fa-facebook text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Meta Ads</h4>
                                    <p class="text-sm text-gray-500">Facebook & Instagram</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Social Media</span>
                        </div>
                        <p class="text-gray-600 mb-4">Target users across Facebook and Instagram with sophisticated audience targeting.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Advanced targeting options
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Visual ad formats
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Massive reach potential
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('meta-ads')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Meta Ads
                        </button>
                    </div>

                    <!-- LinkedIn Ads -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fab fa-linkedin text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">LinkedIn Ads</h4>
                                    <p class="text-sm text-gray-500">Professional Network</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">B2B Focus</span>
                        </div>
                        <p class="text-gray-600 mb-4">Reach professionals and decision-makers with business-focused AI tools.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Professional targeting
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                B2B audience focus
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                High-intent users
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('linkedin-ads')" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure LinkedIn Ads
                        </button>
                    </div>

                    <!-- Twitter Ads -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                    <i class="fab fa-twitter text-gray-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">X Ads (Twitter)</h4>
                                    <p class="text-sm text-gray-500">Real-time Engagement</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full">Social</span>
                        </div>
                        <p class="text-gray-600 mb-4">Engage users in real-time conversations about AI and technology trends.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Real-time engagement
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Tech-savvy audience
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Trending topics integration
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('twitter-ads')" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure X Ads
                        </button>
                    </div>

                    <!-- Taboola -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-newspaper text-orange-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Taboola</h4>
                                    <p class="text-sm text-gray-500">Native Advertising</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full">Content</span>
                        </div>
                        <p class="text-gray-600 mb-4">Native advertising on premium publisher sites with content recommendation widgets.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Premium publisher network
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Native ad integration
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Content discovery
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('taboola')" class="w-full bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Taboola
                        </button>
                    </div>

                    <!-- Outbrain -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-brain text-green-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Outbrain</h4>
                                    <p class="text-sm text-gray-500">Discovery Platform</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Discovery</span>
                        </div>
                        <p class="text-gray-600 mb-4">Content discovery platform reaching users at the point of content consumption.</p>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Content engagement focus
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                High-quality traffic
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                Publisher partnerships
                            </div>
                        </div>
                        <button onclick="configureAdPlatform('outbrain')" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            Configure Outbrain
                        </button>
                    </div>
                </div>
                
                <div class="mt-8 bg-purple-50 p-6 rounded-xl">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-purple-900 mb-2">Diversify Your Advertising Strategy</h4>
                            <p class="text-purple-800 mb-4">While Google AdWords is powerful, diversifying across multiple platforms can reduce dependence and increase overall reach. Each platform serves different audience types and use cases.</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-purple-700">
                                <div class="space-y-2">
                                    <div class="font-medium">Search Platforms</div>
                                    <div>Microsoft Advertising for Bing users</div>
                                </div>
                                <div class="space-y-2">
                                    <div class="font-medium">Social Media</div>
                                    <div>Meta, LinkedIn, and X for social targeting</div>
                                </div>
                                <div class="space-y-2">
                                    <div class="font-medium">Native Content</div>
                                    <div>Taboola and Outbrain for content discovery</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function configureAffiliate(affiliateId) {
            const affiliateData = {
                'amazon': {
                    name: 'Amazon Associates',
                    fields: [
                        { label: 'Associate Tag', name: 'associate_tag', placeholder: 'your-associate-tag-20' },
                        { label: 'Tracking ID', name: 'tracking_id', placeholder: 'amzn1.application-oa2-client.xxxxxxxx' },
                        { label: 'API Access Key', name: 'api_key', placeholder: 'Your API Access Key' }
                    ]
                },
                'bestbuy': {
                    name: 'Best Buy Canada',
                    fields: [
                        { label: 'Partner ID', name: 'partner_id', placeholder: 'Your Partner ID' },
                        { label: 'API Key', name: 'api_key', placeholder: 'Your API Key' }
                    ]
                },
                'canadiantire': {
                    name: 'Canadian Tire',
                    fields: [
                        { label: 'Affiliate ID', name: 'affiliate_id', placeholder: 'Your Affiliate ID' },
                        { label: 'Tracking Code', name: 'tracking_code', placeholder: 'Your Tracking Code' }
                    ]
                },
                'microsoft': {
                    name: 'Microsoft',
                    fields: [
                        { label: 'Publisher ID', name: 'publisher_id', placeholder: 'Your Publisher ID' },
                        { label: 'Campaign ID', name: 'campaign_id', placeholder: 'Your Campaign ID' }
                    ]
                },
                'shopify': {
                    name: 'Shopify',
                    fields: [
                        { label: 'Affiliate Code', name: 'affiliate_code', placeholder: 'Your Affiliate Code' },
                        { label: 'Tracking URL', name: 'tracking_url', placeholder: 'https://www.shopify.com/?ref=yourcode' }
                    ]
                },
                'lenovo': {
                    name: 'Lenovo',
                    fields: [
                        { label: 'Affiliate ID', name: 'affiliate_id', placeholder: 'Your Affiliate ID' },
                        { label: 'Sub ID', name: 'sub_id', placeholder: 'Your Sub ID (optional)' }
                    ]
                }
            };

            const affiliate = affiliateData[affiliateId];
            if (!affiliate) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold">Configure ${affiliate.name}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form class="space-y-4">
                        ${affiliate.fields.map(field => `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">${field.label}</label>
                                <input type="text" name="${field.name}" placeholder="${field.placeholder}" 
                                       class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                        `).join('')}
                        
                        <div class="flex items-center space-x-3 pt-4">
                            <input type="checkbox" id="enable-affiliate" class="rounded text-blue-600">
                            <label for="enable-affiliate" class="text-sm font-medium text-gray-700">Enable this affiliate program</label>
                        </div>
                    </form>
                    
                    <div class="flex justify-end space-x-3 pt-6">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button onclick="saveAffiliateSettings('${affiliateId}', this.closest('.fixed'))" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Save Configuration
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function configureAdPlatform(platformId) {
            const platformData = {
                'microsoft-ads': {
                    name: 'Microsoft Advertising',
                    fields: [
                        { label: 'Customer ID', name: 'customer_id', placeholder: 'Your Customer ID' },
                        { label: 'Account ID', name: 'account_id', placeholder: 'Your Account ID' },
                        { label: 'API Key', name: 'api_key', placeholder: 'Your API Key' }
                    ]
                },
                'meta-ads': {
                    name: 'Meta Ads',
                    fields: [
                        { label: 'App ID', name: 'app_id', placeholder: 'Your App ID' },
                        { label: 'App Secret', name: 'app_secret', placeholder: 'Your App Secret' },
                        { label: 'Ad Account ID', name: 'ad_account_id', placeholder: 'act_xxxxxxxxxx' }
                    ]
                },
                'linkedin-ads': {
                    name: 'LinkedIn Ads',
                    fields: [
                        { label: 'Client ID', name: 'client_id', placeholder: 'Your Client ID' },
                        { label: 'Client Secret', name: 'client_secret', placeholder: 'Your Client Secret' },
                        { label: 'Ad Account URN', name: 'ad_account_urn', placeholder: 'urn:li:sponsoredAccount:xxxxxxxx' }
                    ]
                },
                'twitter-ads': {
                    name: 'X Ads (Twitter)',
                    fields: [
                        { label: 'API Key', name: 'api_key', placeholder: 'Your API Key' },
                        { label: 'API Secret', name: 'api_secret', placeholder: 'Your API Secret' },
                        { label: 'Account ID', name: 'account_id', placeholder: 'Your Account ID' }
                    ]
                },
                'taboola': {
                    name: 'Taboola',
                    fields: [
                        { label: 'Client ID', name: 'client_id', placeholder: 'Your Client ID' },
                        { label: 'Client Secret', name: 'client_secret', placeholder: 'Your Client Secret' },
                        { label: 'Account ID', name: 'account_id', placeholder: 'Your Account ID' }
                    ]
                },
                'outbrain': {
                    name: 'Outbrain',
                    fields: [
                        { label: 'Username', name: 'username', placeholder: 'Your Username' },
                        { label: 'Password', name: 'password', placeholder: 'Your Password', type: 'password' },
                        { label: 'Account ID', name: 'account_id', placeholder: 'Your Account ID' }
                    ]
                }
            };

            const platform = platformData[platformId];
            if (!platform) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold">Configure ${platform.name}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form class="space-y-4">
                        ${platform.fields.map(field => `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">${field.label}</label>
                                <input type="${field.type || 'text'}" name="${field.name}" placeholder="${field.placeholder}" 
                                       class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                        `).join('')}
                        
                        <div class="flex items-center space-x-3 pt-4">
                            <input type="checkbox" id="enable-platform" class="rounded text-blue-600">
                            <label for="enable-platform" class="text-sm font-medium text-gray-700">Enable this advertising platform</label>
                        </div>
                    </form>
                    
                    <div class="flex justify-end space-x-3 pt-6">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button onclick="saveAdPlatformSettings('${platformId}', this.closest('.fixed'))" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Save Configuration
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        async function saveAffiliateSettings(affiliateId, modal) {
            // Collect form data
            const formData = {};
            const inputs = modal.querySelectorAll('input[type="text"], input[type="password"]');
            inputs.forEach(input => {
                formData[input.name] = input.value;
            });
            formData.enabled = modal.querySelector('#enable-affiliate').checked;

            try {
                const response = await fetch('/api/admin/affiliates/configure', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken') || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        affiliateId: affiliateId,
                        settings: formData
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert('Affiliate settings saved successfully!');
                    modal.remove();
                    await loadAffiliateMarketingData(); // Reload the section
                } else {
                    alert('Failed to save affiliate settings: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving affiliate settings:', error);
                alert('Failed to save affiliate settings');
            }
        }

        async function saveAdPlatformSettings(platformId, modal) {
            // Collect form data
            const formData = {};
            const inputs = modal.querySelectorAll('input[type="text"], input[type="password"]');
            inputs.forEach(input => {
                formData[input.name] = input.value;
            });
            formData.enabled = modal.querySelector('#enable-platform').checked;

            try {
                const response = await fetch('/api/admin/advertising-platforms/configure', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken') || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        platformId: platformId,
                        settings: formData
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert('Platform settings saved successfully!');
                    modal.remove();
                    await loadOtherAdvertisingData(); // Reload the section
                } else {
                    alert('Failed to save platform settings: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving platform settings:', error);
                alert('Failed to save platform settings');
            }
        }

        // Analytics Dashboard Functions
        async function loadAnalyticsData() {
            try {
                document.getElementById('analytics-loading').classList.remove('hidden');
                document.getElementById('analytics-dashboard-content').classList.add('hidden');

                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/analytics/dashboard?days=30', {
                    headers: {
                        'Authorization': `Bearer ${token || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    displayAnalyticsOverview(data.data);
                    displayAnalyticsTrends(data.data.trends || []);
                    displayAnalyticsProjects(data.data.top_projects || []);
                    displayAnalyticsDeviceStats(data.data.device_stats || []);
                } else {
                    displayAnalyticsError('Failed to load analytics data');
                }

                document.getElementById('analytics-loading').classList.add('hidden');
                document.getElementById('analytics-dashboard-content').classList.remove('hidden');

            } catch (error) {
                console.error('Error loading analytics:', error);
                displayAnalyticsError('Failed to connect to analytics service');
                document.getElementById('analytics-loading').classList.add('hidden');
                document.getElementById('analytics-dashboard-content').classList.remove('hidden');
            }
        }

        function displayAnalyticsOverview(data) {
            const summary = data.summary || {};
            
            document.getElementById('total-projects').textContent = summary.total_projects || 0;
            document.getElementById('total-views').textContent = formatNumber(summary.total_views || 0);
            document.getElementById('active-users').textContent = formatNumber(summary.active_users || 0);
            document.getElementById('total-conversions').textContent = formatNumber(summary.total_conversions || 0);
        }

        function displayAnalyticsTrends(trends) {
            const ctx = document.getElementById('trends-chart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (window.analyticsChart) {
                window.analyticsChart.destroy();
            }

            if (!trends.length) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                return;
            }

            const labels = trends.slice().reverse().map(d => formatDate(d.date, true));
            const views = trends.slice().reverse().map(d => parseInt(d.views) || 0);
            const starts = trends.slice().reverse().map(d => parseInt(d.starts) || 0);
            const completions = trends.slice().reverse().map(d => parseInt(d.completions) || 0);

            window.analyticsChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Views',
                        data: views,
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: false
                    }, {
                        label: 'Form Starts',
                        data: starts,
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4,
                        fill: false
                    }, {
                        label: 'Completions',
                        data: completions,
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: true,
                            title: { display: true, text: 'Date' }
                        },
                        y: {
                            display: true,
                            title: { display: true, text: 'Count' },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
        }

        function displayAnalyticsProjects(projects) {
            const tbody = document.getElementById('projects-table-body');
            
            if (!projects.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                            <i class="fas fa-chart-line text-4xl mb-4 block text-gray-300"></i>
                            No analytics data available yet. Deploy some projects to see statistics.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = projects.map(project => {
                const completionRate = parseFloat(project.completion_rate) || 0;
                const statusBadge = project.name ? 
                    '<span class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Active</span>' :
                    '<span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full">Draft</span>';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-tools text-blue-600"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${escapeHtml(project.name || 'Untitled Project')}</div>
                                    <div class="text-sm text-gray-500">${project.subdomain ? project.subdomain + '.tool.prompt-machine.com' : 'Not deployed'}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">${statusBadge}</td>
                        <td class="px-6 py-4 text-sm text-gray-900">${formatNumber(project.total_interactions || 0)}</td>
                        <td class="px-6 py-4 text-sm text-gray-900">${formatNumber(project.unique_sessions || 0)}</td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                            <div class="flex items-center">
                                <div class="flex-1">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-600 h-2 rounded-full" style="width: ${Math.min(completionRate, 100)}%"></div>
                                    </div>
                                </div>
                                <div class="ml-2 text-sm text-gray-600">${completionRate.toFixed(1)}%</div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">${formatNumber(project.completions || 0)}</td>
                        <td class="px-6 py-4">
                            <div class="flex items-center space-x-2">
                                <button onclick="viewProjectAnalytics('${project.id}')" 
                                        class="text-blue-600 hover:text-blue-900 text-sm">
                                    <i class="fas fa-chart-bar mr-1"></i>View Details
                                </button>
                                ${project.subdomain ? `
                                    <a href="https://${project.subdomain}.tool.prompt-machine.com" target="_blank"
                                       class="text-green-600 hover:text-green-900 text-sm">
                                        <i class="fas fa-external-link-alt mr-1"></i>Open Tool
                                    </a>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function displayAnalyticsDeviceStats(deviceStats) {
            const container = document.getElementById('device-stats');
            if (!container || !deviceStats.length) {
                container.innerHTML = '<div class="text-center py-4 text-gray-500">No device data available</div>';
                return;
            }

            container.innerHTML = deviceStats.map(stat => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-${getDeviceIcon(stat.device_type)} text-blue-600"></i>
                        </div>
                        <span class="font-medium text-gray-900 capitalize">${stat.device_type}</span>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold text-gray-900">${formatNumber(stat.count)}</div>
                        <div class="text-xs text-gray-500">${stat.percentage}%</div>
                    </div>
                </div>
            `).join('');
        }

        function displayAnalyticsError(message) {
            document.getElementById('analytics-dashboard-content').innerHTML = `
                <div class="bg-red-50 border border-red-200 rounded-lg p-8 text-center">
                    <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                    <h3 class="text-lg font-semibold text-red-900 mb-2">Analytics Unavailable</h3>
                    <p class="text-red-700">${message}</p>
                    <button onclick="loadAnalyticsData()" class="mt-4 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                        Try Again
                    </button>
                </div>
            `;
        }

        function refreshAnalytics() {
            loadAnalyticsData();
        }

        function viewProjectAnalytics(projectId) {
            // Redirect to analytics section with project filter
            showSection('analytics');
            // Could be enhanced to filter by specific project
            alert(`Analytics for project ${projectId} - showing general analytics dashboard`);
        }

        function getDeviceIcon(deviceType) {
            const icons = {
                'desktop': 'desktop',
                'mobile': 'mobile-alt',
                'tablet': 'tablet-alt'
            };
            return icons[deviceType] || 'device';
        }

        function formatNumber(num, decimals = 0) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(num);
        }

        function formatDate(dateStr, short = false) {
            const date = new Date(dateStr);
            if (short) {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric'
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Prompt Engineer Functions
        let allProjects = [];
        
        async function loadPromptEngineerProjects() {
            try {
                document.getElementById('projects-loading').classList.remove('hidden');
                document.getElementById('projects-grid').classList.add('hidden');
                document.getElementById('projects-empty').classList.add('hidden');

                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/v6/projects', {
                    headers: {
                        'Authorization': `Bearer ${token || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success && data.projects) {
                    allProjects = data.projects;
                    displayPromptEngineerStats(allProjects);
                    displayPromptEngineerProjects(allProjects);
                    
                    if (allProjects.length === 0) {
                        document.getElementById('projects-empty').classList.remove('hidden');
                    } else {
                        document.getElementById('projects-grid').classList.remove('hidden');
                    }
                } else {
                    document.getElementById('projects-empty').classList.remove('hidden');
                }

                document.getElementById('projects-loading').classList.add('hidden');

            } catch (error) {
                console.error('Error loading projects:', error);
                document.getElementById('projects-loading').classList.add('hidden');
                document.getElementById('projects-empty').classList.remove('hidden');
            }
        }

        function displayPromptEngineerStats(projects) {
            const totalProjects = projects.length;
            const deployedProjects = projects.filter(p => p.deployed).length;
            const totalViews = projects.reduce((sum, p) => sum + (parseInt(p.view_count) || 0), 0);

            document.getElementById('pe-total-projects').textContent = totalProjects;
            document.getElementById('pe-deployed-projects').textContent = deployedProjects;
            document.getElementById('pe-total-views').textContent = formatNumber(totalViews);
        }

        function displayPromptEngineerProjects(projects) {
            const container = document.getElementById('projects-list');
            
            if (projects.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <i class="fas fa-magic text-4xl text-gray-300 mb-4"></i>
                        <p>No projects found matching the current filter.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = projects.map(project => {
                const statusBadge = getProjectStatusBadge(project);
                const deployedBadge = project.deployed 
                    ? '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"><i class="fas fa-rocket mr-1"></i>Deployed</span>'
                    : '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800"><i class="fas fa-draft2digital mr-1"></i>Draft</span>';
                
                return `
                    <div class="p-6 hover:bg-gray-50 transition-colors">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-magic text-white text-lg"></i>
                                    </div>
                                </div>
                                <div class="min-w-0 flex-1">
                                    <div class="flex items-center space-x-3">
                                        <h4 class="text-lg font-semibold text-gray-900 truncate">${escapeHtml(project.name || 'Untitled Project')}</h4>
                                        ${deployedBadge}
                                        ${statusBadge}
                                    </div>
                                    <div class="mt-1 flex items-center space-x-4 text-sm text-gray-500">
                                        <span><i class="fas fa-user mr-1"></i>${project.ai_role || 'AI Assistant'}</span>
                                        ${project.subdomain ? `<span><i class="fas fa-globe mr-1"></i>${project.subdomain}.tool.prompt-machine.com</span>` : ''}
                                        <span><i class="fas fa-calendar mr-1"></i>${formatDate(project.created_at, true)}</span>
                                        <span><i class="fas fa-eye mr-1"></i>${formatNumber(project.view_count || 0)} views</span>
                                    </div>
                                    ${project.description ? `<p class="mt-2 text-sm text-gray-600 line-clamp-2">${escapeHtml(project.description)}</p>` : ''}
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                ${project.deployed ? `
                                    <a href="https://${project.subdomain}.tool.prompt-machine.com" target="_blank" 
                                       class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        <i class="fas fa-external-link-alt mr-1.5"></i>View
                                    </a>
                                ` : ''}
                                <button onclick="editProject('${project.id}')" 
                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <i class="fas fa-edit mr-1.5"></i>Edit
                                </button>
                                <div class="relative">
                                    <button onclick="toggleProjectMenu('${project.id}')" 
                                            class="inline-flex items-center px-2 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div id="menu-${project.id}" class="hidden absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10">
                                        <div class="py-1" role="menu">
                                            <button onclick="duplicateProject('${project.id}')" class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                <i class="fas fa-copy mr-2"></i>Duplicate
                                            </button>
                                            <button onclick="recreateProject('${project.id}')" class="flex items-center w-full px-4 py-2 text-sm text-blue-700 hover:bg-blue-50">
                                                <i class="fas fa-redo mr-2"></i>Recreate (Reset to Step 1)
                                            </button>
                                            <button onclick="toggleProjectStatus('${project.id}')" class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                <i class="fas fa-power-off mr-2"></i>${project.enabled ? 'Disable' : 'Enable'}
                                            </button>
                                            <button onclick="viewProjectAnalytics('${project.id}')" class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                <i class="fas fa-chart-bar mr-2"></i>Analytics
                                            </button>
                                            <div class="border-t border-gray-100"></div>
                                            <button onclick="deleteProject('${project.id}')" class="flex items-center w-full px-4 py-2 text-sm text-red-700 hover:bg-red-50">
                                                <i class="fas fa-trash mr-2"></i>Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getProjectStatusBadge(project) {
            if (project.deployed && project.enabled) {
                return '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">Live</span>';
            } else if (project.enabled) {
                return '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Active</span>';
            } else {
                return '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">Inactive</span>';
            }
        }

        function filterProjects() {
            const filter = document.getElementById('status-filter').value;
            let filteredProjects = [...allProjects];

            switch (filter) {
                case 'deployed':
                    filteredProjects = allProjects.filter(p => p.deployed);
                    break;
                case 'draft':
                    filteredProjects = allProjects.filter(p => !p.deployed);
                    break;
                case 'enabled':
                    filteredProjects = allProjects.filter(p => p.enabled);
                    break;
                case 'disabled':
                    filteredProjects = allProjects.filter(p => !p.enabled);
                    break;
            }

            displayPromptEngineerProjects(filteredProjects);
        }

        async function createNewProject() {
            // Redirect to the standalone Prompt Engineer v6.1.0rc page instead of embedding
            window.location.href = '/prompt-engineer-v6.html';
        }

        async function editProject(projectId) {
            // Redirect to the standalone Prompt Engineer v6.1.0rc page with project ID
            window.location.href = `/prompt-engineer-v6.html?edit=${projectId}`;
        }

        async function loadPromptEngineerInterface(projectId = null) {
            const container = document.getElementById('prompt-engineer-container');
            
            // Show loading state
            container.innerHTML = `
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">Loading Prompt Engineer...</p>
                </div>
            `;
            
            try {
                // Fetch the prompt engineer page
                const response = await fetch('/prompt-engineer-v6.html');
                const html = await response.text();
                
                // Parse the HTML and extract the main content
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Remove the navigation from the fetched content
                const nav = doc.querySelector('nav');
                if (nav) nav.remove();
                
                // Get the main content container
                const mainContainer = doc.querySelector('main') || doc.querySelector('.container') || doc.querySelector('.max-w-7xl');
                
                if (mainContainer) {
                    // Create a header for the embedded interface
                    const headerHtml = `
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-6">
                            <div class="p-6 border-b border-gray-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900">
                                            ${projectId ? 'Edit Project' : 'Create New Project'}
                                        </h3>
                                        <p class="text-sm text-gray-600 mt-1">
                                            ${projectId ? 'Modify your existing AI tool' : 'Build a new AI-powered tool with advanced prompt engineering'}
                                        </p>
                                    </div>
                                    <button onclick="closePromptEngineerInterface()" class="text-gray-400 hover:text-gray-600 transition-colors">
                                        <i class="fas fa-times text-xl"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Embed the interface with header
                    container.innerHTML = `
                        ${headerHtml}
                        <div class="prompt-engineer-embedded">
                            ${mainContainer.innerHTML}
                        </div>
                    `;
                    
                    // Copy over any necessary scripts and styles
                    const scripts = doc.querySelectorAll('script');
                    scripts.forEach(script => {
                        if (script.src && !script.src.includes('cdn')) {
                            // Only copy local scripts, skip CDN scripts as they're already loaded
                            const newScript = document.createElement('script');
                            newScript.src = script.src;
                            container.appendChild(newScript);
                        } else if (!script.src && script.textContent.includes('function') && !script.textContent.includes('document.addEventListener')) {
                            // Copy inline function definitions but skip event listeners
                            const newScript = document.createElement('script');
                            newScript.textContent = script.textContent;
                            container.appendChild(newScript);
                        }
                    });
                    
                    // If editing a specific project, set the project ID in the URL parameters
                    if (projectId) {
                        // Update the embedded interface to load the specific project
                        setTimeout(() => {
                            if (window.loadProject && typeof window.loadProject === 'function') {
                                window.loadProject(projectId);
                            }
                        }, 500);
                    }
                    
                } else {
                    container.innerHTML = `
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center">
                            <p class="text-red-600">Error: Could not load prompt engineer interface</p>
                            <button onclick="closePromptEngineerInterface()" class="mt-4 px-4 py-2 bg-gray-600 text-white rounded-lg">
                                Close
                            </button>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading prompt engineer interface:', error);
                container.innerHTML = `
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 text-center">
                        <p class="text-red-600">Failed to load prompt engineer interface</p>
                        <button onclick="closePromptEngineerInterface()" class="mt-4 px-4 py-2 bg-gray-600 text-white rounded-lg">
                            Close
                        </button>
                    </div>
                `;
            }
        }

        function closePromptEngineerInterface() {
            // Hide the embedded container and show the projects grid
            document.getElementById('prompt-engineer-container').classList.add('hidden');
            document.getElementById('projects-grid').classList.remove('hidden');
            
            // Refresh the projects list to show any changes
            loadPromptEngineerProjects();
        }

        function toggleProjectMenu(projectId) {
            // Hide all other menus first
            document.querySelectorAll('[id^="menu-"]').forEach(menu => {
                if (menu.id !== `menu-${projectId}`) {
                    menu.classList.add('hidden');
                }
            });
            
            // Toggle the clicked menu
            const menu = document.getElementById(`menu-${projectId}`);
            menu.classList.toggle('hidden');
        }

        async function duplicateProject(projectId) {
            alert('Project duplication feature will be implemented in a future update');
            document.getElementById(`menu-${projectId}`).classList.add('hidden');
        }

        async function toggleProjectStatus(projectId) {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/v6/projects/${projectId}/toggle-enabled`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('Project status updated successfully');
                    loadPromptEngineerProjects(); // Refresh the projects list
                } else {
                    alert(data.error || 'Failed to update project status');
                }
            } catch (error) {
                console.error('Error toggling project status:', error);
                alert('Error updating project status - feature not yet implemented');
            }
            document.getElementById(`menu-${projectId}`).classList.add('hidden');
        }

        async function deleteProject(projectId) {
            if (!confirm('Are you sure you want to delete this project? This action cannot be undone.')) {
                document.getElementById(`menu-${projectId}`).classList.add('hidden');
                return;
            }

            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/v6/projects/${projectId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('Project deleted successfully');
                    loadPromptEngineerProjects(); // Refresh the projects list
                } else {
                    alert(data.error || 'Failed to delete project');
                }
            } catch (error) {
                console.error('Error deleting project:', error);
                alert('Error deleting project');
            }
            document.getElementById(`menu-${projectId}`).classList.add('hidden');
        }

        async function recreateProject(projectId) {
            if (!confirm('This will create a new project with the same basic information but reset to step 1 of the workflow. You can then go through the newest Prompt Engineer process from the beginning. Continue?')) {
                document.getElementById(`menu-${projectId}`).classList.add('hidden');
                return;
            }

            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/v6/projects/${projectId}/recreate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    alert(`Project recreated successfully! New project: "${data.project.name}"\n\nThe new project is ready for you to go through the step 1-3 workflow with the newest Prompt Engineer logic.`);
                    loadPromptEngineerProjects(); // Refresh the projects list
                    
                    // Optionally, redirect to edit the new project
                    if (confirm('Would you like to start editing the recreated project now?')) {
                        editProject(data.project.id);
                    }
                } else {
                    alert(data.error || 'Failed to recreate project');
                }
            } catch (error) {
                console.error('Error recreating project:', error);
                alert('Error recreating project');
            }
            document.getElementById(`menu-${projectId}`).classList.add('hidden');
        }

        // Close menus when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('[id^="menu-"]') && !event.target.closest('button[onclick^="toggleProjectMenu"]')) {
                document.querySelectorAll('[id^="menu-"]').forEach(menu => {
                    menu.classList.add('hidden');
                });
            }
        });

        // Update the openPromptEngineerInterface function - now redirects to standalone page
        async function openPromptEngineerInterface() {
            window.location.href = '/prompt-engineer-v6.html';
        }
        
        // Package Manager Functions
        let availablePackages = []; // Store packages globally for modal use
        
        async function loadPackagesData() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/admin/packages/all', {
                    headers: {
                        'Authorization': `Bearer ${token || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success) {
                    availablePackages = data.packages || []; // Store packages globally
                    displayPackagesData(data.packages || [], data.users || []);
                } else {
                    document.getElementById('packages-grid').innerHTML = '<p class="text-red-500 text-center py-8">Error loading package data</p>';
                    document.getElementById('package-users-table-body').innerHTML = '<tr><td colspan="4" class="text-center py-8 text-red-500">Error loading package data</td></tr>';
                }
            } catch (error) {
                console.error('Error loading packages:', error);
                document.getElementById('packages-grid').innerHTML = '<p class="text-red-500 text-center py-8">Failed to load package data</p>';
                document.getElementById('package-users-table-body').innerHTML = '<tr><td colspan="4" class="text-center py-8 text-red-500">Failed to load users data</td></tr>';
            }
        }
        
        function displayPackagesData(packages, users) {
            const packagesHtml = packages.map(pkg => `
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">${pkg.display_name}</h4>
                    <p class="text-gray-600 mb-2">Price: $${pkg.price}/${pkg.billing_period}</p>
                    <p class="text-gray-600 mb-4">Limits: ${JSON.stringify(pkg.limits).replace(/[{}]/g, '').replace(/"/g, '').replace(/:/g, ': ').replace(/,/g, ', ')}</p>
                    <div class="flex space-x-2">
                        <button onclick="editPackage('${pkg.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm">
                            Edit
                        </button>
                        <button onclick="deletePackage('${pkg.id}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded text-sm">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
            
            const usersHtml = users.slice(0, 10).map(user => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${user.package_name || 'Free'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${user.usage_count || 0}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editUserModal('${user.id}', '${user.email}', '${user.package_name || 'Free'}')" class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                        <button onclick="changePackageModal('${user.id}', '${user.email}')" class="text-green-600 hover:text-green-900">Change Package</button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('packages-grid').innerHTML = packagesHtml || '<p class="text-gray-500 text-center py-8">No packages available</p>';
            document.getElementById('package-users-table-body').innerHTML = usersHtml || '<tr><td colspan="4" class="text-center py-8 text-gray-500">No users found</td></tr>';
        }
        
        // User editing functionality
        function editUserModal(userId, email, currentPackage) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold mb-4">Edit User: ${email}</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="edit-email" value="${email}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Current Package</label>
                            <p class="text-gray-600">${currentPackage}</p>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg">Cancel</button>
                        <button onclick="saveUserEdit('${userId}')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Save Changes</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function changePackageModal(userId, email) {
            // Build package options from available packages
            const packageOptions = availablePackages.map(pkg => 
                `<option value="${pkg.name}">${pkg.display_name} - $${pkg.price}/${pkg.billing_period}</option>`
            ).join('');
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold mb-4">Change Package: ${email}</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Package</label>
                            <select id="package-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option value="">No Package</option>
                                ${packageOptions}
                            </select>
                        </div>
                        <div class="text-sm text-gray-500">
                            <p><strong>Available Packages:</strong></p>
                            ${availablePackages.map(pkg => `
                                <div class="mt-1">
                                    <strong>${pkg.display_name}</strong>: ${pkg.description} 
                                    <span class="text-green-600">$${pkg.price}/${pkg.billing_period}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg">Cancel</button>
                        <button onclick="savePackageChange('${userId}')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">Change Package</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        async function saveUserEdit(userId) {
            const newEmail = document.getElementById('edit-email').value;
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email: newEmail })
                });
                
                if (response.ok) {
                    alert('User updated successfully');
                    document.querySelector('.fixed').remove();
                    loadPackagesData(); // Refresh the data
                } else {
                    alert('Failed to update user');
                }
            } catch (error) {
                console.error('Error updating user:', error);
                alert('Error updating user');
            }
        }
        
        async function savePackageChange(userId) {
            const newPackage = document.getElementById('package-select').value;
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/admin/users/${userId}/package`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token || 'dummy-token'}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ package: newPackage })
                });
                
                if (response.ok) {
                    alert('Package updated successfully');
                    document.querySelector('.fixed').remove();
                    loadPackagesData(); // Refresh the data
                } else {
                    alert('Failed to update package');
                }
            } catch (error) {
                console.error('Error updating package:', error);
                alert('Error updating package');
            }
        }
        
        // Placeholder functions for other interactions
        function manageAdvertising(toolId) {
            // Redirect to advertising section
            showSection('advertising');
            alert(`Advertising management for tool ${toolId} - check the Advertising section for configuration`);
        }
        
        function editPackage(packageId) {
            // For now, show package details in a simple alert - could be enhanced with a modal
            alert(`Package editing interface would open here for package ID: ${packageId}`);
        }
        
        async function deletePackage(packageId) {
            if (!confirm('Are you sure you want to delete this package? This action cannot be undone.')) {
                return;
            }

            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`/api/admin/packages/${packageId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('Package deleted successfully');
                    loadPackagesData(); // Refresh the packages list
                } else {
                    alert(data.error || 'Failed to delete package');
                }
            } catch (error) {
                console.error('Error deleting package:', error);
                alert('Error deleting package');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAuth()) {
                loadDashboardData();
            }
        });
    </script>

    <!-- User Management Modals -->
    <div id="addUserModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Add New User</h3>
                <button onclick="hideAddUserModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addUserForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="userEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="user@example.com" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Package (Optional)</label>
                    <select id="userPackage" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">No Package</option>
                        <option value="free">Free</option>
                        <option value="pro">Pro</option>
                        <option value="enterprise">Enterprise</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="hideAddUserModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">Add User</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editUserModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Edit User</h3>
                <button onclick="hideEditUserModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="editUserEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Package</label>
                    <select id="editUserPackage" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">No Package</option>
                        <option value="free">Free</option>
                        <option value="pro">Pro</option>
                        <option value="enterprise">Enterprise</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="hideEditUserModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>
